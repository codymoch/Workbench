<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CRA Working Report</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #1a56db;
    --primary-light: #e8f0fe;
    --primary-dark: #1240a8;
    --accent: #f97316;
    --accent-light: #fff4ed;
    --success: #16a34a;
    --success-light: #dcfce7;
    --warning: #d97706;
    --warning-light: #fef3c7;
    --danger: #dc2626;
    --danger-light: #fee2e2;
    --gray-50: #f9fafb;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-300: #d1d5db;
    --gray-400: #9ca3af;
    --gray-500: #6b7280;
    --gray-600: #4b5563;
    --gray-700: #374151;
    --gray-800: #1f2937;
    --gray-900: #111827;
    --sidebar-width: 260px;
    --header-height: 56px;
    --font: 'DM Sans', sans-serif;
    --mono: 'DM Mono', monospace;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--font);
    background: var(--gray-50);
    color: var(--gray-800);
    font-size: 14px;
    line-height: 1.5;
  }

  /* ── TOP HEADER ── */
  .header {
    height: var(--header-height);
    background: #fff;
    border-bottom: 1px solid var(--gray-200);
    display: flex;
    align-items: center;
    padding: 0 20px;
    gap: 16px;
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 100;
    box-shadow: 0 1px 3px rgba(0,0,0,.06);
  }

  .header-logo {
    font-weight: 600;
    font-size: 15px;
    color: var(--primary);
    letter-spacing: -.3px;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .header-logo .dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; }

  .header-divider { width: 1px; height: 24px; background: var(--gray-200); }

  .header-report-info { display: flex; flex-direction: column; }
  .header-report-name { font-weight: 600; font-size: 13px; color: var(--gray-800); }
  .header-report-sub { font-size: 11px; color: var(--gray-400); font-family: var(--mono); }

  .header-spacer { flex: 1; }

  .header-status-badge {
    display: flex; align-items: center; gap: 6px;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 500;
    background: var(--warning-light);
    color: var(--warning);
    border: 1px solid #fde68a;
  }
  .header-status-badge .pulse {
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--warning);
    animation: pulse 1.8s ease-in-out infinite;
  }
  @keyframes pulse {
    0%,100% { opacity: 1; transform: scale(1); }
    50% { opacity: .5; transform: scale(1.3); }
  }

  .header-btn {
    padding: 6px 14px;
    border-radius: 7px;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    font-family: var(--font);
    transition: all .15s;
    border: 1px solid var(--gray-200);
    background: #fff;
    color: var(--gray-700);
  }
  .header-btn:hover { background: var(--gray-50); border-color: var(--gray-300); }
  .header-btn.primary { background: var(--primary); color: #fff; border-color: var(--primary); }
  .header-btn.primary:hover { background: var(--primary-dark); }

  /* ── LAYOUT ── */
  .layout {
    display: flex;
    margin-top: var(--header-height);
    min-height: calc(100vh - var(--header-height));
  }

  /* ── SIDEBAR ── */
  .sidebar {
    width: var(--sidebar-width);
    background: #fff;
    border-right: 1px solid var(--gray-200);
    position: fixed;
    top: var(--header-height);
    left: 0;
    bottom: 0;
    overflow-y: auto;
  }

  .sidebar::-webkit-scrollbar { width: 4px; }
  .sidebar::-webkit-scrollbar-track { background: transparent; }
  .sidebar::-webkit-scrollbar-thumb { background: var(--gray-200); border-radius: 4px; }

  .sidebar-section { padding: 16px 0 8px; }

  .sidebar-section-label {
    padding: 0 16px 6px;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: .08em;
    text-transform: uppercase;
    color: var(--gray-400);
  }

  .sidebar-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 16px;
    cursor: pointer;
    transition: all .12s;
    border-left: 3px solid transparent;
    position: relative;
    color: var(--gray-600);
    font-size: 13px;
    font-weight: 400;
  }
  .sidebar-item:hover { background: var(--gray-50); color: var(--gray-800); }
  .sidebar-item.active {
    background: var(--primary-light);
    color: var(--primary);
    border-left-color: var(--primary);
    font-weight: 500;
  }

  .sidebar-item-icon {
    width: 28px; height: 28px;
    border-radius: 7px;
    display: flex; align-items: center; justify-content: center;
    background: var(--gray-100);
    font-size: 13px;
    flex-shrink: 0;
  }
  .sidebar-item.active .sidebar-item-icon { background: var(--primary-light); }

  .sidebar-badge {
    margin-left: auto;
    font-size: 10px;
    font-weight: 600;
    padding: 1px 6px;
    border-radius: 10px;
    font-family: var(--mono);
  }
  .badge-pending { background: var(--warning-light); color: var(--warning); }
  .badge-clear { background: var(--success-light); color: var(--success); }
  .badge-hit { background: var(--danger-light); color: var(--danger); }
  .badge-review { background: var(--primary-light); color: var(--primary); }

  .sidebar-divider { height: 1px; background: var(--gray-100); margin: 8px 16px; }

  /* ── MAIN CONTENT ── */
  .main {
    margin-left: var(--sidebar-width);
    flex: 1;
    padding: 0 20px 20px;
    min-height: calc(100vh - var(--header-height));
  }
  .main-panel-content {
    padding-top: 16px;
  }

  /* ── PANEL HEADER ── */
  .panel-header {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    margin-bottom: 20px;
  }
  .panel-title-group { flex: 1; }
  .panel-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--gray-900);
    letter-spacing: -.3px;
  }
  .panel-subtitle { font-size: 12px; color: var(--gray-400); margin-top: 2px; }

  .panel-actions { display: flex; gap: 8px; flex-shrink: 0; }

  /* ── CARD ── */
  .card {
    background: #fff;
    border: 1px solid var(--gray-200);
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 16px;
  }
  .card-header {
    padding: 12px 16px;
    border-bottom: 1px solid var(--gray-100);
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--gray-50);
  }
  .card-header-title {
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: .06em;
    color: var(--gray-500);
  }
  .card-header-spacer { flex: 1; }
  .card-body { padding: 16px; }

  /* ── SUBJECT OVERVIEW ── */
  .subject-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
  }
  @media (max-width: 900px) { .subject-grid { grid-template-columns: 1fr 1fr; } }

  .subject-field label {
    display: block;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: .07em;
    color: var(--gray-400);
    margin-bottom: 3px;
  }
  .subject-field .val {
    font-size: 13px;
    color: var(--gray-800);
    font-weight: 500;
  }

  .overview-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    margin-bottom: 16px;
  }
  .stat-card {
    background: #fff;
    border: 1px solid var(--gray-200);
    border-radius: 10px;
    padding: 14px 16px;
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .stat-card .stat-label { font-size: 11px; color: var(--gray-400); font-weight: 500; text-transform: uppercase; letter-spacing: .06em; }
  .stat-card .stat-value { font-size: 22px; font-weight: 600; color: var(--gray-900); letter-spacing: -.5px; }
  .stat-card .stat-sub { font-size: 11px; color: var(--gray-400); }
  .stat-card.accent-orange { border-top: 3px solid var(--accent); }
  .stat-card.accent-blue { border-top: 3px solid var(--primary); }
  .stat-card.accent-green { border-top: 3px solid var(--success); }
  .stat-card.accent-red { border-top: 3px solid var(--danger); }

  /* ── STATUS PILL ── */
  .status-pill {
    display: inline-flex; align-items: center; gap: 5px;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 600;
  }
  .status-pill.pending { background: var(--warning-light); color: var(--warning); }
  .status-pill.clear { background: var(--success-light); color: var(--success); }
  .status-pill.hit { background: var(--danger-light); color: var(--danger); }
  .status-pill.review { background: var(--primary-light); color: var(--primary); }
  .status-pill .dot { width: 5px; height: 5px; border-radius: 50%; background: currentColor; }

  /* ── SEARCHES TABLE (in overview) ── */
  .searches-table { width: 100%; border-collapse: collapse; }
  .searches-table th {
    text-align: left;
    padding: 8px 12px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: .07em;
    color: var(--gray-400);
    border-bottom: 1px solid var(--gray-100);
    background: var(--gray-50);
  }
  .searches-table td {
    padding: 10px 12px;
    border-bottom: 1px solid var(--gray-100);
    font-size: 13px;
    color: var(--gray-700);
  }
  .searches-table tr:last-child td { border-bottom: none; }
  .searches-table tr:hover td { background: var(--gray-50); }
  .searches-table .open-btn {
    padding: 4px 10px;
    font-size: 11px;
    font-weight: 500;
    background: var(--primary-light);
    color: var(--primary);
    border: 1px solid #bfdbfe;
    border-radius: 5px;
    cursor: pointer;
    font-family: var(--font);
    transition: all .12s;
  }
  .searches-table .open-btn:hover { background: var(--primary); color: #fff; }

  /* ── CRIMINAL SEARCH PANEL ── */
  .search-meta-bar {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    background: var(--gray-50);
    border: 1px solid var(--gray-200);
    border-radius: 10px;
    margin-bottom: 16px;
    flex-wrap: wrap;
  }
  .meta-item { display: flex; flex-direction: column; gap: 1px; }
  .meta-item .meta-label { font-size: 10px; color: var(--gray-400); font-weight: 600; text-transform: uppercase; letter-spacing: .06em; }
  .meta-item .meta-val { font-size: 12px; color: var(--gray-700); font-weight: 500; font-family: var(--mono); }
  .meta-sep { width: 1px; height: 30px; background: var(--gray-200); }
  .meta-spacer { flex: 1; }

  .process-btn {
    padding: 8px 18px;
    background: var(--accent);
    color: #fff;
    border: none;
    border-radius: 7px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    font-family: var(--font);
    transition: all .15s;
    display: flex; align-items: center; gap: 6px;
  }
  .process-btn:hover { background: #ea6c05; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(249,115,22,.3); }

  /* Criminal records table */
  .records-table { width: 100%; border-collapse: collapse; }
  .records-table th {
    text-align: left;
    padding: 9px 12px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: .07em;
    color: var(--gray-400);
    border-bottom: 2px solid var(--gray-200);
    background: var(--gray-50);
    white-space: nowrap;
  }
  .records-table td {
    padding: 10px 12px;
    border-bottom: 1px solid var(--gray-100);
    font-size: 12px;
    color: var(--gray-700);
    vertical-align: middle;
  }
  .records-table tr:last-child td { border-bottom: none; }
  .records-table tr.selected td { background: #fef9f0; }
  .records-table tr:hover td { background: var(--gray-50); cursor: pointer; }
  .records-table tr.selected:hover td { background: #fef3e2; }

  .record-charge { font-weight: 500; color: var(--gray-800); }
  .record-sub { font-size: 11px; color: var(--gray-400); }

  .checkbox-cell { width: 36px; text-align: center; }
  .custom-checkbox {
    width: 16px; height: 16px;
    border: 2px solid var(--gray-300);
    border-radius: 4px;
    cursor: pointer;
    display: inline-flex; align-items: center; justify-content: center;
    transition: all .12s;
    background: #fff;
  }
  .custom-checkbox.checked { background: var(--accent); border-color: var(--accent); }
  .custom-checkbox.checked::after { content: '✓'; color: #fff; font-size: 10px; font-weight: 700; }

  .reverify-actions {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  .action-select {
    padding: 4px 8px;
    font-size: 11px;
    border: 1px solid var(--gray-200);
    border-radius: 5px;
    color: var(--gray-700);
    background: #fff;
    font-family: var(--font);
    cursor: pointer;
  }
  .action-select:focus { outline: 2px solid var(--primary-light); border-color: var(--primary); }

  /* Criminal record detail expand */
  .record-expand {
    background: var(--gray-50);
    border-top: 1px solid var(--gray-100);
  }
  .record-expand-inner {
    padding: 14px 16px 14px 52px;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
  }

  /* ── EMPLOYMENT / EDUCATION PANEL ── */
  .verification-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
  }
  .verification-col {
    padding: 16px;
  }
  .verification-col:first-child { border-right: 1px solid var(--gray-100); }
  .verification-col-header {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: .08em;
    color: var(--gray-400);
    margin-bottom: 14px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--gray-100);
  }

  .form-field {
    margin-bottom: 12px;
  }
  .form-field label {
    display: block;
    font-size: 11px;
    font-weight: 500;
    color: var(--gray-500);
    margin-bottom: 3px;
  }
  .form-field .applicant-val {
    font-size: 12px;
    color: var(--gray-700);
    padding: 6px 8px;
    background: var(--gray-50);
    border-radius: 5px;
    border: 1px solid var(--gray-100);
    min-height: 30px;
    font-weight: 500;
  }
  .form-field input, .form-field select {
    width: 100%;
    padding: 6px 10px;
    font-size: 12px;
    border: 1px solid var(--gray-200);
    border-radius: 6px;
    font-family: var(--font);
    color: var(--gray-800);
    background: #fff;
    transition: border-color .12s;
  }
  .form-field input:focus, .form-field select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px var(--primary-light);
  }

  .field-row {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  .match-indicator {
    width: 20px; height: 20px;
    border-radius: 50%;
    flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    font-size: 10px;
    font-weight: 700;
  }
  .match-yes { background: var(--success-light); color: var(--success); }
  .match-no { background: var(--danger-light); color: var(--danger); }
  .match-unknown { background: var(--gray-100); color: var(--gray-400); }

  /* MVR Panel */
  .mvr-violations { width: 100%; border-collapse: collapse; }
  .mvr-violations th {
    text-align: left;
    padding: 8px 12px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: .07em;
    color: var(--gray-400);
    background: var(--gray-50);
    border-bottom: 2px solid var(--gray-200);
  }
  .mvr-violations td {
    padding: 10px 12px;
    border-bottom: 1px solid var(--gray-100);
    font-size: 12px;
    color: var(--gray-700);
  }
  .mvr-violations tr:last-child td { border-bottom: none; }
  .mvr-violations tr:hover td { background: var(--gray-50); }

  /* ── ACTION SIDEBAR (right panel inside main content) ── */
  .content-with-actions {
    display: grid;
    grid-template-columns: 1fr 220px;
    gap: 14px;
    align-items: start;
  }
  .content-with-actions > div:first-child { min-width: 0; }
  @media (max-width: 1100px) { .content-with-actions { grid-template-columns: 1fr; } }

  .actions-panel {
    background: #fff;
    border: 1px solid var(--gray-200);
    border-radius: 10px;
    position: sticky;
    top: 80px;
    min-width: 240px;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
    overflow-x: hidden;
  }
  .actions-panel::-webkit-scrollbar { width: 4px; }
  .actions-panel::-webkit-scrollbar-thumb { background: var(--gray-200); border-radius: 4px; }
  .actions-panel-section { padding: 12px; border-bottom: 1px solid var(--gray-100); }
  .actions-panel-section:last-child { border-bottom: none; }
  .actions-section-title {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: .08em;
    color: var(--gray-400);
    margin-bottom: 8px;
  }
  .action-link {
    display: block;
    padding: 5px 0;
    font-size: 12px;
    color: var(--primary);
    cursor: pointer;
    text-decoration: none;
    transition: color .1s;
  }
  .action-link:hover { color: var(--primary-dark); text-decoration: underline; }
  .action-link.danger { color: var(--danger); }
  .action-link.danger:hover { color: #b91c1c; }

  .disposition-select {
    width: 100%;
    padding: 6px 8px;
    font-size: 12px;
    border: 1px solid var(--gray-200);
    border-radius: 6px;
    font-family: var(--font);
    color: var(--gray-700);
    background: #fff;
    cursor: pointer;
    margin-bottom: 6px;
  }
  .disposition-select:focus { outline: none; border-color: var(--primary); }

  .submit-dispo-btn {
    width: 100%;
    padding: 7px;
    background: var(--primary);
    color: #fff;
    border: none;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    font-family: var(--font);
    transition: background .12s;
  }
  .submit-dispo-btn:hover { background: var(--primary-dark); }

  /* Call history */
  .call-history-item {
    display: flex;
    gap: 8px;
    padding: 6px 0;
    border-bottom: 1px solid var(--gray-100);
  }
  .call-history-item:last-child { border-bottom: none; }
  .call-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--gray-300);
    margin-top: 5px;
    flex-shrink: 0;
  }
  .call-dot.attempted { background: var(--warning); }
  .call-dot.completed { background: var(--success); }
  .call-info { flex: 1; }
  .call-info .call-status { font-size: 11px; font-weight: 500; color: var(--gray-700); }
  .call-info .call-time { font-size: 10px; color: var(--gray-400); font-family: var(--mono); }

  /* ── NOTES ── */
  .notes-area {
    width: 100%;
    padding: 8px 10px;
    font-size: 12px;
    border: 1px solid var(--gray-200);
    border-radius: 6px;
    font-family: var(--font);
    resize: vertical;
    min-height: 70px;
    color: var(--gray-700);
  }
  .notes-area:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-light); }

  /* ── BREADCRUMB ── */
  .breadcrumb {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 16px;
    font-size: 12px;
    color: var(--gray-400);
  }
  .breadcrumb .crumb { cursor: pointer; }
  .breadcrumb .crumb:hover { color: var(--primary); }
  .breadcrumb .crumb.active { color: var(--gray-700); font-weight: 500; pointer-events: none; }
  .breadcrumb .sep { color: var(--gray-300); }

  /* ── TAB BAR ── */
  .tab-bar {
    display: flex;
    gap: 0;
    border-bottom: 2px solid var(--gray-200);
    margin-bottom: 16px;
  }
  .tab {
    padding: 8px 16px;
    font-size: 12px;
    font-weight: 500;
    color: var(--gray-500);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    margin-bottom: -2px;
    transition: all .12s;
  }
  .tab:hover { color: var(--gray-700); }
  .tab.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600; }

  /* ── HIDDEN PANELS ── */
  .panel { display: none; }
  .panel.active { display: block; }

  /* ── TOAST ── */
  .toast {
    position: fixed;
    bottom: 24px; right: 24px;
    background: var(--gray-900);
    color: #fff;
    padding: 10px 16px;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 500;
    z-index: 1000;
    opacity: 0;
    transform: translateY(10px);
    transition: all .2s;
    pointer-events: none;
  }
  .toast.show { opacity: 1; transform: translateY(0); }

  /* ── EXPAND ROW ── */
  .expand-row { display: none; }
  .expand-row.open { display: table-row; }

  /* Billing section */
  .billing-row { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; }
  .billing-row label { font-size: 11px; color: var(--gray-500); width: 80px; flex-shrink: 0; }
  .billing-row input {
    flex: 1; padding: 5px 8px; font-size: 12px;
    border: 1px solid var(--gray-200); border-radius: 5px;
    font-family: var(--font); color: var(--gray-700);
  }
  .billing-row input:focus { outline: none; border-color: var(--primary); }

  /* Tiny tag */
  .tag {
    display: inline-block;
    padding: 1px 7px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 600;
    background: var(--gray-100);
    color: var(--gray-500);
  }
  .tag.felony { background: var(--danger-light); color: var(--danger); }
  .tag.misdemeanor { background: var(--warning-light); color: var(--warning); }
  .tag.infraction { background: var(--primary-light); color: var(--primary); }

  /* ── QUEUE CONTEXT BANNER ── */
  .queue-banner {
    display: flex; align-items: center; gap: 10px;
    padding: 8px 24px;
    background: #fffbeb; border-bottom: 1px solid #fde68a;
    font-size: 12px; color: var(--warning);
    position: fixed; top: var(--header-height); left: 0; right: 0;
    z-index: 99; transition: all .2s;
  }
  .queue-banner.hidden { display: none; }
  .queue-banner .qb-text { font-weight: 500; color: var(--gray-700); }
  .queue-banner .qb-detail { color: var(--gray-400); font-size: 11px; }
  .queue-banner .qb-spacer { flex: 1; }
  .queue-banner .qb-nav { display: flex; align-items: center; gap: 6px; }
  .queue-banner .qb-pos { font-size: 11px; color: var(--gray-500); font-family: var(--mono); }
  .qb-arrow {
    width: 26px; height: 26px; border: 1px solid var(--gray-200); border-radius: 5px;
    background: #fff; display: flex; align-items: center; justify-content: center;
    cursor: pointer; font-size: 12px; color: var(--gray-500); transition: all .12s;
  }
  .qb-arrow:hover { background: var(--gray-50); color: var(--gray-700); }
  .qb-arrow.disabled { opacity: .35; pointer-events: none; }
  .qb-back {
    padding: 4px 12px; background: #fff; border: 1px solid var(--gray-200); border-radius: 5px;
    font-size: 11px; font-weight: 600; color: var(--gray-600); cursor: pointer;
    font-family: var(--font); transition: all .12s; display: flex; align-items: center; gap: 5px;
  }
  .qb-back:hover { background: var(--gray-50); border-color: var(--gray-300); }
  .sidebar-item.queue-hidden {
    opacity: .55;
    pointer-events: auto;
  }
  .sidebar-item.queue-hidden:hover { opacity: 1; background: var(--gray-50); }
  .sidebar-item.queue-hidden .sidebar-badge { opacity: .6; }
  .sidebar-item .queue-focus-tag {
    display: none; margin-left: 4px;
    font-size: 9px; font-weight: 700; padding: 1px 5px; border-radius: 3px;
    background: var(--accent); color: #fff; letter-spacing: .04em; text-transform: uppercase;
  }
  .sidebar-item.queue-focused .queue-focus-tag { display: inline; }
  .sidebar-item.queue-focused { border-left-color: var(--accent) !important; background: #fff4ed !important; color: #c2410c !important; }
  .sidebar-item .queue-other-tag {
    display: none; margin-left: auto;
    font-size: 9px; font-weight: 600; padding: 1px 5px; border-radius: 3px;
    background: var(--gray-100); color: var(--gray-400);
    letter-spacing: .03em; white-space: nowrap;
  }
  body.queue-mode .sidebar-item.queue-hidden .queue-other-tag { display: inline; }
  body.queue-mode .sidebar-item.queue-hidden .sidebar-badge { display: none; }
  body.queue-mode .layout { margin-top: calc(var(--header-height) + 37px); }
  body.queue-mode .sidebar { top: calc(var(--header-height) + 37px); }
  .queue-mode-label {
    display: none; padding: 6px 16px 10px;
    font-size: 10px; font-weight: 600; letter-spacing: .06em; text-transform: uppercase;
    color: #c2410c; background: #fff4ed; border-bottom: 1px solid #fed7aa;
    align-items: center; gap: 6px;
  }
  body.queue-mode .queue-mode-label { display: flex; }
  .queue-nav-btns { display: none; gap: 6px; }
  body.queue-mode .queue-nav-btns { display: flex; }
  .qnav-btn {
    padding: 6px 12px; font-size: 12px; font-weight: 500; border-radius: 7px; cursor: pointer;
    font-family: var(--font); border: 1px solid var(--gray-200); background: #fff;
    color: var(--gray-600); display: flex; align-items: center; gap: 5px; transition: all .12s;
  }
  .qnav-btn:hover { background: var(--gray-50); border-color: var(--gray-300); }
  .qnav-btn.next { background: var(--accent); color: #fff; border-color: var(--accent); }
  .qnav-btn.next:hover { background: #ea6c05; }


  /* ── PERSISTENT SUBJECT BAR ── */
  .subject-bar {
    background: #fff;
    border: 1px solid var(--gray-200);
    border-radius: 0 0 8px 8px;
    border-top: none;
    margin-bottom: 0;
    overflow: hidden;
    transition: all .2s;
    box-shadow: 0 2px 6px rgba(0,0,0,.07);
    position: sticky;
    top: 0;
    z-index: 90;
  }
  .subject-bar-inner {
    display: flex;
    align-items: flex-start;
    gap: 14px;
    padding: 12px 16px;
  }
  .subject-bar-avatar {
    width: 40px; height: 40px;
    border-radius: 10px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: #fff;
    font-size: 13px;
    font-weight: 700;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
    letter-spacing: .5px;
  }
  .subject-bar-fields { flex: 1; overflow: hidden; }
  .subject-bar-row {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0;
    row-gap: 8px;
  }
  .sb-field {
    display: flex;
    flex-direction: column;
    gap: 1px;
    padding: 0 12px;
  }
  .sb-field:first-child { padding-left: 0; }
  .sb-label {
    font-size: 9px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: .07em;
    color: var(--gray-400);
    white-space: nowrap;
  }
  .sb-val {
    font-size: 12px;
    font-weight: 500;
    color: var(--gray-800);
    white-space: nowrap;
  }
  .sb-name { font-weight: 700; color: var(--gray-900); font-size: 13px; }
  .sb-sensitive { font-family: var(--mono); font-size: 11px; color: var(--gray-600); }
  .sb-muted { color: var(--gray-400); font-weight: 400; }
  .sb-sep {
    width: 1px;
    height: 28px;
    background: var(--gray-100);
    flex-shrink: 0;
    align-self: center;
  }
  .sb-collapse-btn {
    background: none; border: none; cursor: pointer;
    font-size: 11px; color: var(--gray-400); padding: 4px 6px;
    border-radius: 5px; transition: all .12s; flex-shrink: 0;
    line-height: 1; align-self: flex-start;
  }
  .sb-collapse-btn:hover { background: var(--gray-100); color: var(--gray-600); }
  .subject-bar.collapsed .subject-bar-inner { padding: 6px 16px; min-height: 0; }
  .subject-bar.collapsed .subject-bar-fields { display: none; }
  .subject-bar.collapsed .subject-bar-avatar { width: 28px; height: 28px; font-size: 10px; border-radius: 7px; }
  .subject-bar.collapsed .sb-collapse-btn { align-self: center; }
  .subject-bar.collapsed .sb-name-inline {
    display: inline-block;
    font-size: 12px; font-weight: 600; color: var(--gray-700);
    margin-left: 4px;
  }
  .sb-name-inline { display: none; }
  .subject-bar-collapsed-label {
    display: none;
    align-items: center;
    gap: 8px;
    flex: 1;
  }
  .subject-bar.collapsed .subject-bar-collapsed-label { display: flex; }
  .sb-collapsed-name { font-size: 12px; font-weight: 600; color: var(--gray-800); }
  .sb-collapsed-details { font-size: 11px; color: var(--gray-400); font-family: var(--mono); }



  /* ── CONFIGURE ACTIONS MODAL ── */
  .config-overlay {
    position: fixed; inset: 0;
    background: rgba(17,24,39,.45);
    backdrop-filter: blur(3px);
    z-index: 400;
    display: flex; align-items: flex-start; justify-content: flex-end;
    opacity: 0; pointer-events: none;
    transition: opacity .18s;
  }
  .config-overlay.open { opacity: 1; pointer-events: auto; }
  .config-drawer {
    width: 320px;
    background: #fff;
    height: 100vh;
    overflow-y: auto;
    box-shadow: -8px 0 32px rgba(0,0,0,.12);
    transform: translateX(100%);
    transition: transform .2s cubic-bezier(.4,0,.2,1);
    display: flex; flex-direction: column;
  }
  .config-overlay.open .config-drawer { transform: translateX(0); }
  .config-drawer::-webkit-scrollbar { width: 4px; }
  .config-drawer::-webkit-scrollbar-thumb { background: var(--gray-200); border-radius: 4px; }
  .config-drawer-header {
    padding: 16px 16px 12px;
    border-bottom: 1px solid var(--gray-100);
    position: sticky; top: 0; background: #fff; z-index: 1;
    display: flex; align-items: center; gap: 10px;
  }
  .config-drawer-title { font-size: 14px; font-weight: 600; color: var(--gray-900); flex: 1; }
  .config-drawer-sub { font-size: 11px; color: var(--gray-400); margin-top: 1px; }
  .config-close-btn {
    width: 28px; height: 28px; border-radius: 7px;
    border: 1px solid var(--gray-200); background: #fff;
    cursor: pointer; font-size: 14px; color: var(--gray-500);
    display: flex; align-items: center; justify-content: center;
    transition: all .12s;
  }
  .config-close-btn:hover { background: var(--gray-100); color: var(--gray-700); }
  .config-section { padding: 12px 16px; border-bottom: 1px solid var(--gray-100); }
  .config-section:last-of-type { border-bottom: none; }
  .config-section-label {
    font-size: 9px; font-weight: 700; text-transform: uppercase;
    letter-spacing: .08em; color: var(--gray-400); margin-bottom: 10px;
    display: flex; align-items: center; gap: 6px;
  }
  .config-section-label .cs-toggle-all {
    margin-left: auto; font-size: 9px; font-weight: 600;
    color: var(--primary); cursor: pointer; text-transform: none; letter-spacing: 0;
  }
  .config-section-label .cs-toggle-all:hover { text-decoration: underline; }
  .config-item {
    display: flex; align-items: center; gap: 10px;
    padding: 6px 0;
    border-bottom: 1px solid var(--gray-50);
    cursor: pointer;
    user-select: none;
  }
  .config-item:last-child { border-bottom: none; }
  .config-item:hover .config-item-label { color: var(--gray-900); }
  .config-item-label {
    flex: 1; font-size: 12px; color: var(--gray-600);
    transition: color .1s;
  }
  .config-item-label.disabled-label { color: var(--gray-300); text-decoration: line-through; }
  /* Toggle switch */
  .toggle {
    width: 32px; height: 18px; border-radius: 9px;
    background: var(--gray-200); position: relative;
    cursor: pointer; transition: background .15s; flex-shrink: 0;
    border: none; padding: 0;
  }
  .toggle.on { background: var(--primary); }
  .toggle::after {
    content: ''; position: absolute;
    width: 14px; height: 14px; border-radius: 50%;
    background: #fff; top: 2px; left: 2px;
    transition: transform .15s;
    box-shadow: 0 1px 3px rgba(0,0,0,.2);
  }
  .toggle.on::after { transform: translateX(14px); }
  .config-drawer-footer {
    padding: 12px 16px;
    border-top: 1px solid var(--gray-100);
    display: flex; gap: 8px;
    position: sticky; bottom: 0; background: #fff;
  }
  .config-save-btn {
    flex: 1; padding: 8px; background: var(--primary); color: #fff;
    border: none; border-radius: 7px; font-size: 12px; font-weight: 600;
    cursor: pointer; font-family: var(--font); transition: background .12s;
  }
  .config-save-btn:hover { background: var(--primary-dark); }
  .config-reset-btn {
    padding: 8px 14px; background: #fff; color: var(--gray-500);
    border: 1px solid var(--gray-200); border-radius: 7px; font-size: 12px;
    cursor: pointer; font-family: var(--font); transition: all .12s;
  }
  .config-reset-btn:hover { background: var(--gray-50); }

  /* Configure button on actions panel */
  .actions-panel-header {
    display: flex; align-items: center;
    padding: 10px 12px 6px;
    border-bottom: 1px solid var(--gray-100);
  }
  .actions-panel-title {
    font-size: 10px; font-weight: 700; text-transform: uppercase;
    letter-spacing: .08em; color: var(--gray-500); flex: 1;
  }
  .configure-btn {
    display: flex; align-items: center; gap: 4px;
    padding: 3px 8px;
    background: var(--gray-50); border: 1px solid var(--gray-200);
    border-radius: 5px; font-size: 10px; font-weight: 600;
    color: var(--gray-500); cursor: pointer;
    font-family: var(--font); transition: all .12s;
    letter-spacing: .02em;
  }
  .configure-btn:hover { background: var(--primary-light); border-color: #bfdbfe; color: var(--primary); }
  .configure-btn svg { width: 11px; height: 11px; }

  /* Hidden action items */
  .action-link.action-hidden,
  .actions-panel-section.section-hidden { display: none; }
  .actions-panel-section.section-empty-check:not(:has(.action-link:not(.action-hidden))) { display: none; }


  /* ── HISTORY MODAL ── */
  .history-overlay {
    position: fixed; inset: 0;
    background: rgba(17,24,39,.5);
    backdrop-filter: blur(3px);
    z-index: 450;
    display: flex; align-items: flex-start; justify-content: center;
    padding-top: 60px;
    opacity: 0; pointer-events: none;
    transition: opacity .18s;
  }
  .history-overlay.open { opacity: 1; pointer-events: auto; }
  .history-modal {
    background: #fff;
    border-radius: 12px;
    width: 820px; max-width: 96vw;
    max-height: 78vh;
    display: flex; flex-direction: column;
    box-shadow: 0 20px 60px rgba(0,0,0,.18);
    transform: translateY(-12px) scale(.98);
    transition: transform .2s cubic-bezier(.4,0,.2,1);
    overflow: hidden;
  }
  .history-overlay.open .history-modal { transform: translateY(0) scale(1); }
  .history-modal-header {
    padding: 14px 18px 12px;
    border-bottom: 1px solid var(--gray-100);
    display: flex; align-items: flex-start; gap: 12px;
    flex-shrink: 0;
  }
  .history-modal-icon {
    width: 34px; height: 34px; border-radius: 8px;
    background: var(--primary-light);
    display: flex; align-items: center; justify-content: center;
    font-size: 15px; flex-shrink: 0;
  }
  .history-modal-title { font-size: 15px; font-weight: 600; color: var(--gray-900); }
  .history-modal-sub { font-size: 11px; color: var(--gray-400); margin-top: 2px; }
  .history-modal-spacer { flex: 1; }
  .history-close-btn {
    width: 30px; height: 30px; border-radius: 7px;
    border: 1px solid var(--gray-200); background: #fff;
    cursor: pointer; font-size: 14px; color: var(--gray-500);
    display: flex; align-items: center; justify-content: center;
    transition: all .12s; flex-shrink: 0;
  }
  .history-close-btn:hover { background: var(--gray-100); }
  .history-toolbar {
    padding: 10px 18px;
    border-bottom: 1px solid var(--gray-100);
    display: flex; align-items: center; gap: 8px;
    background: var(--gray-50); flex-shrink: 0;
  }
  .history-search {
    flex: 1; padding: 6px 10px; font-size: 12px;
    border: 1px solid var(--gray-200); border-radius: 6px;
    font-family: var(--font); color: var(--gray-700);
    background: #fff;
  }
  .history-search:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-light); }
  .history-filter {
    padding: 6px 10px; font-size: 11px;
    border: 1px solid var(--gray-200); border-radius: 6px;
    font-family: var(--font); color: var(--gray-600); background: #fff; cursor: pointer;
  }
  .history-count {
    font-size: 11px; color: var(--gray-400); font-family: var(--mono); white-space: nowrap;
  }
  .history-table-wrap {
    overflow-y: auto; flex: 1;
  }
  .history-table-wrap::-webkit-scrollbar { width: 5px; }
  .history-table-wrap::-webkit-scrollbar-thumb { background: var(--gray-200); border-radius: 4px; }
  .history-table {
    width: 100%; border-collapse: collapse;
  }
  .history-table thead tr {
    position: sticky; top: 0; z-index: 1;
  }
  .history-table th {
    text-align: left; padding: 9px 14px;
    font-size: 10px; font-weight: 700; text-transform: uppercase;
    letter-spacing: .07em; color: var(--gray-400);
    background: #fff; border-bottom: 2px solid var(--gray-100);
    white-space: nowrap; cursor: pointer; user-select: none;
  }
  .history-table th:hover { color: var(--gray-600); }
  .history-table th .sort-arrow { opacity: .4; margin-left: 3px; font-size: 9px; }
  .history-table th.sorted .sort-arrow { opacity: 1; color: var(--primary); }
  .history-table td {
    padding: 9px 14px; border-bottom: 1px solid var(--gray-100);
    font-size: 12px; color: var(--gray-700); vertical-align: top;
  }
  .history-table tr:last-child td { border-bottom: none; }
  .history-table tr:hover td { background: var(--gray-50); }
  .history-table .td-num { font-family: var(--mono); font-size: 11px; color: var(--gray-500); }
  .history-table .td-date { font-family: var(--mono); font-size: 11px; white-space: nowrap; }
  .history-table .td-by { font-size: 11px; color: var(--gray-500); white-space: nowrap; }
  .history-table .td-desc { color: var(--gray-700); }
  .history-table .td-detail a {
    font-size: 11px; color: var(--primary); cursor: pointer; white-space: nowrap;
    text-decoration: none;
  }
  .history-table .td-detail a:hover { text-decoration: underline; }
  .history-type-badge {
    display: inline-block; padding: 1px 6px; border-radius: 3px;
    font-size: 9px; font-weight: 700; text-transform: uppercase; letter-spacing: .04em;
    margin-right: 4px;
  }
  .hbadge-system { background: var(--gray-100); color: var(--gray-500); }
  .hbadge-user   { background: var(--primary-light); color: var(--primary); }
  .hbadge-auto   { background: var(--warning-light); color: var(--warning); }
  .hbadge-status { background: var(--success-light); color: var(--success); }
  .history-modal-footer {
    padding: 10px 18px;
    border-top: 1px solid var(--gray-100);
    display: flex; align-items: center; gap: 8px;
    background: var(--gray-50); flex-shrink: 0;
  }
  .history-footer-info { font-size: 11px; color: var(--gray-400); flex: 1; }
  .history-export-btn {
    padding: 5px 12px; font-size: 11px; font-weight: 600;
    border: 1px solid var(--gray-200); border-radius: 5px; background: #fff;
    color: var(--gray-600); cursor: pointer; font-family: var(--font); transition: all .12s;
  }
  .history-export-btn:hover { background: var(--gray-50); border-color: var(--gray-300); }

  /* View History button style */
  .view-history-btn {
    display: flex; align-items: center; gap: 5px;
    padding: 6px 13px;
    border: 1px solid var(--gray-200);
    border-radius: 7px; background: #fff;
    font-size: 12px; font-weight: 500;
    color: var(--gray-600); cursor: pointer;
    font-family: var(--font); transition: all .15s;
  }
  .view-history-btn:hover { background: var(--gray-50); border-color: var(--gray-300); color: var(--gray-800); }
  .view-history-btn svg { width: 13px; height: 13px; opacity: .6; }


  /* ── FILL STATUS BAR ── */
  .fill-status-bar {
    display: flex; align-items: stretch;
    background: #fff;
    border: 1.5px solid var(--gray-200); border-radius: 10px;
    margin-bottom: 16px; overflow: hidden;
    box-shadow: 0 1px 4px rgba(0,0,0,.05);
  }
  /* All columns are the same component */
  .fsb-col {
    display: flex; flex-direction: column; justify-content: center; gap: 3px;
    padding: 9px 14px;
    border-right: 1px solid var(--gray-100);
    flex-shrink: 0;
  }
  .fsb-col:last-child { border-right: none; }
  .fsb-col.fsb-status-col {
    background: var(--gray-50);
    border-left: 1.5px solid var(--gray-200);
  }
  .fsb-col-label {
    font-size: 9px; font-weight: 700; text-transform: uppercase;
    letter-spacing: .08em; color: var(--gray-400); white-space: nowrap;
    display: flex; align-items: center; gap: 4px;
  }
  .fsb-col-label .fsb-required {
    width: 5px; height: 5px; border-radius: 50%; background: var(--accent); display: inline-block;
  }
  .fsb-col-val {
    font-size: 12px; font-weight: 500; color: var(--gray-700);
    font-family: var(--mono); white-space: nowrap;
  }
  .fsb-select {
    appearance: none; -webkit-appearance: none;
    padding: 4px 24px 4px 8px; font-size: 12px; font-weight: 600;
    border: 1.5px solid var(--gray-200); border-radius: 6px;
    font-family: var(--font); cursor: pointer;
    background: #fff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='11' height='11' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2.5'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E") no-repeat right 6px center;
    transition: all .15s; color: var(--gray-800); min-width: 120px;
  }
  .fsb-select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-light); }
  .fsb-select:hover { border-color: var(--gray-300); }
  .fsb-select.status-inprogress { border-color: #fde68a; background-color: #fffbeb; color: var(--warning); }
  .fsb-select.status-complete   { border-color: #86efac; background-color: #f0fdf4; color: var(--success); }
  .fsb-select.code-unknown  { border-color: var(--gray-300); color: var(--gray-500); }
  .fsb-select.code-clear    { border-color: #86efac; background-color: #f0fdf4; color: var(--success); }
  .fsb-select.code-hits     { border-color: #fca5a5; background-color: #fff5f5; color: var(--danger); }
  .fsb-select.code-custom   { border-color: #bfdbfe; background-color: #eff6ff; color: var(--primary); }
  .fsb-save-col {
    display: flex; align-items: center; padding: 9px 12px;
    background: var(--gray-50); border-left: 1px solid var(--gray-100);
    gap: 6px; flex-shrink: 0;
  }
  .fsb-save-btn {
    padding: 5px 12px; font-size: 11px; font-weight: 700;
    background: var(--primary); color: #fff; border: none; border-radius: 6px;
    cursor: pointer; font-family: var(--font); transition: all .15s; white-space: nowrap;
  }
  .fsb-save-btn:hover { background: var(--primary-dark); }
  .fsb-saved-indicator {
    font-size: 10px; color: var(--success); font-weight: 600;
    opacity: 0; transition: opacity .3s; white-space: nowrap;
  }
  .fsb-saved-indicator.show { opacity: 1; }


  /* ── SIDEBAR SEARCH SUB-LIST ── */
  .sidebar-group { }

  .sidebar-group-header {
    display: flex; align-items: center; gap: 10px;
    padding: 8px 16px; cursor: pointer;
    transition: all .12s; border-left: 3px solid transparent;
    color: var(--gray-600); font-size: 13px; font-weight: 400;
    user-select: none;
  }
  .sidebar-group-header:hover { background: var(--gray-50); color: var(--gray-800); }
  .sidebar-group-header.active {
    background: var(--primary-light); color: var(--primary);
    border-left-color: var(--primary); font-weight: 500;
  }
  .sidebar-group-header.queue-focused { border-left-color: var(--accent) !important; background: #fff4ed !important; color: #c2410c !important; }
  .sidebar-group-header.queue-hidden { opacity: .55; }
  .sidebar-group-header.queue-hidden:hover { opacity: 1; }

  .sgr-chevron {
    margin-left: auto; font-size: 9px; color: var(--gray-400);
    transition: transform .15s; flex-shrink: 0;
  }
  .sidebar-group-header.expanded .sgr-chevron { transform: rotate(90deg); }
  .sgr-badge { flex-shrink: 0; }

  .sidebar-sublist {
    display: none; overflow: hidden;
  }
  .sidebar-sublist.open { display: block; }

  .sidebar-subitem {
    display: flex; align-items: flex-start; gap: 0;
    padding: 7px 14px 7px 38px;
    cursor: pointer; transition: all .1s;
    border-left: 3px solid transparent;
    position: relative;
  }
  .sidebar-subitem::before {
    content: '';
    position: absolute; left: 24px; top: 0; bottom: 0;
    width: 1px; background: var(--gray-100);
  }
  .sidebar-subitem:last-child::before { bottom: 50%; }
  .sidebar-subitem::after {
    content: '';
    position: absolute; left: 24px; top: 50%;
    width: 8px; height: 1px; background: var(--gray-100);
  }
  .sidebar-subitem:hover { background: var(--gray-50); }
  .sidebar-subitem.active {
    background: var(--primary-light);
    border-left-color: var(--primary);
  }
  .sidebar-subitem.active .ssi-name { color: var(--primary); font-weight: 600; }

  .ssi-content { flex: 1; min-width: 0; }
  .ssi-name {
    font-size: 11px; font-weight: 500; color: var(--gray-700);
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    line-height: 1.3;
  }
  .ssi-meta {
    font-size: 10px; color: var(--gray-400); margin-top: 1px;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .ssi-badge {
    flex-shrink: 0; font-size: 9px; font-weight: 700;
    padding: 1px 5px; border-radius: 3px; margin-left: 6px; margin-top: 1px;
    font-family: var(--mono);
  }

  /* ── SEARCH LIST PANEL (when clicking parent group header) ── */
  .search-list-panel { }
  .search-list-grid {
    display: flex; flex-direction: column; gap: 8px;
  }
  .search-list-card {
    background: #fff;
    border: 1.5px solid var(--gray-200);
    border-radius: 10px;
    padding: 14px 16px;
    display: flex; align-items: center; gap: 14px;
    cursor: pointer; transition: all .15s;
    position: relative; overflow: hidden;
  }
  .search-list-card::before {
    content: ''; position: absolute; left: 0; top: 0; bottom: 0;
    width: 4px; background: var(--gray-200); transition: background .15s;
  }
  .search-list-card:hover { border-color: var(--primary); box-shadow: 0 2px 12px rgba(26,86,219,.08); }
  .search-list-card:hover::before { background: var(--primary); }
  .search-list-card.status-hit::before { background: var(--danger); }
  .search-list-card.status-hit { border-color: #fca5a5; }
  .search-list-card.status-clear::before { background: var(--success); }
  .search-list-card.status-clear { border-color: #86efac; }
  .search-list-card.status-pending::before { background: var(--warning); }
  .search-list-card.status-review::before { background: var(--primary); }

  .slc-icon {
    width: 38px; height: 38px; border-radius: 9px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; flex-shrink: 0; background: var(--gray-50);
  }
  .slc-main { flex: 1; min-width: 0; }
  .slc-type { font-size: 12px; font-weight: 600; color: var(--gray-800); }
  .slc-jurisdiction { font-size: 11px; color: var(--gray-500); margin-top: 2px; }
  .slc-name-tag {
    display: inline-flex; align-items: center; gap: 4px;
    margin-top: 5px; padding: 2px 8px;
    background: var(--gray-50); border: 1px solid var(--gray-200);
    border-radius: 4px; font-size: 10px; font-weight: 500;
    color: var(--gray-600);
  }
  .slc-name-tag .alias-dot {
    width: 5px; height: 5px; border-radius: 50%; background: var(--accent);
  }
  .slc-meta { display: flex; gap: 12px; align-items: center; flex-shrink: 0; flex-wrap: wrap; justify-content: flex-end; }
  .slc-meta-item { display: flex; flex-direction: column; align-items: flex-end; gap: 1px; }
  .slc-meta-label { font-size: 9px; color: var(--gray-400); font-weight: 600; text-transform: uppercase; letter-spacing: .06em; }
  .slc-meta-val { font-size: 11px; color: var(--gray-600); font-family: var(--mono); }
  .slc-open-btn {
    padding: 6px 14px; background: var(--primary); color: #fff;
    border: none; border-radius: 6px; font-size: 11px; font-weight: 600;
    cursor: pointer; font-family: var(--font); transition: all .12s; flex-shrink: 0;
  }
  .slc-open-btn:hover { background: var(--primary-dark); }

  .search-list-section-label {
    font-size: 10px; font-weight: 700; text-transform: uppercase;
    letter-spacing: .08em; color: var(--gray-400);
    padding: 14px 0 6px; display: flex; align-items: center; gap: 8px;
  }
  .search-list-section-label::after {
    content: ''; flex: 1; height: 1px; background: var(--gray-100);
  }


  /* ── VERIFICATION COPY FORM ── */
  .verif-form { width: 100%; }

  .verif-header-row {
    display: grid;
    grid-template-columns: 1fr 32px 1fr;
    gap: 0 12px;
    padding: 10px 16px 8px;
    border-bottom: 2px solid var(--gray-100);
    margin-bottom: 0;
  }
  .verif-header-row .vh-label {
    font-size: 10px; font-weight: 700; text-transform: uppercase;
    letter-spacing: .08em; color: var(--gray-400);
  }
  .verif-header-row .vh-label:nth-child(3) { padding-left: 4px; }

  .verif-row {
    display: grid;
    grid-template-columns: 1fr 32px 1fr;
    gap: 0 12px;
    padding: 10px 16px;
    border-bottom: 1px solid var(--gray-50);
    align-items: center;
  }
  .verif-row:last-child { border-bottom: none; }
  .verif-row:hover { background: #fafafa; }

  .verif-applicant {
    display: flex; flex-direction: column; gap: 2px;
  }
  .verif-field-label {
    font-size: 10px; font-weight: 600; color: var(--gray-400);
    text-transform: uppercase; letter-spacing: .06em;
  }
  .verif-applicant-val {
    font-size: 13px; font-weight: 500; color: var(--gray-800);
    padding: 5px 0;
  }
  .verif-applicant-val.empty { color: var(--gray-300); font-style: italic; font-size: 12px; }

  .verif-copy-btn {
    width: 28px; height: 28px; border-radius: 6px;
    border: 1px solid var(--gray-200); background: #fff;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: all .15s;
    color: var(--gray-400); flex-shrink: 0; align-self: flex-end; margin-bottom: 2px;
  }
  .verif-copy-btn:hover {
    background: var(--primary); border-color: var(--primary); color: #fff;
    transform: scale(1.08);
  }
  .verif-copy-btn svg { width: 12px; height: 12px; pointer-events: none; }
  .verif-copy-btn.copied {
    background: var(--success); border-color: var(--success); color: #fff;
  }

  .verif-confirmed {
    display: flex; flex-direction: column; gap: 2px;
  }
  .verif-confirmed-inner {
    display: flex; align-items: center; gap: 6px;
  }
  .verif-confirmed input, .verif-confirmed select {
    flex: 1; padding: 5px 9px; font-size: 12px;
    border: 1.5px solid var(--gray-200); border-radius: 6px;
    font-family: var(--font); color: var(--gray-800); background: #fff;
    transition: border-color .12s;
  }
  .verif-confirmed input:focus, .verif-confirmed select:focus {
    outline: none; border-color: var(--primary);
    box-shadow: 0 0 0 3px var(--primary-light);
  }
  .verif-confirmed input.filled { border-color: var(--gray-300); background: #fafafa; }

  .match-indicator {
    width: 20px; height: 20px; border-radius: 50%; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    font-size: 10px; font-weight: 700;
  }
  .match-yes     { background: var(--success-light); color: var(--success); }
  .match-no      { background: var(--danger-light);  color: var(--danger);  }
  .match-unknown { background: var(--gray-100);       color: var(--gray-400); }

  .verif-form-footer {
    padding: 12px 16px;
    border-top: 1px solid var(--gray-100);
    background: var(--gray-50);
    display: flex; align-items: center; gap: 8px;
  }
  .copy-all-btn {
    display: flex; align-items: center; gap: 6px;
    padding: 6px 14px; font-size: 12px; font-weight: 600;
    border: 1px solid var(--gray-200); border-radius: 7px;
    background: #fff; color: var(--gray-600); cursor: pointer;
    font-family: var(--font); transition: all .15s;
  }
  .copy-all-btn:hover { background: var(--primary-light); border-color: #bfdbfe; color: var(--primary); }
  .copy-all-btn svg { width: 13px; height: 13px; }


  .action-info-field { padding: 3px 0; }
  .aif-label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: .06em; color: var(--gray-400); }
  .aif-val { font-size: 12px; color: var(--gray-700); font-weight: 500; margin-top: 1px; }
  .action-upload-btn {
    display: flex; align-items: center; gap: 6px;
    padding: 6px 0; font-size: 12px; color: var(--primary);
    cursor: pointer; font-weight: 500;
    border-bottom: 1px solid var(--gray-50);
  }
  .action-upload-btn:last-child { border-bottom: none; }
  .action-upload-btn:hover { color: var(--primary-dark); }


  /* ── GAP ANALYSIS TABLE ── */
  .gap-analysis-card { margin-bottom: 16px; }
  .gap-table { width: 100%; border-collapse: collapse; font-size: 12px; }
  .gap-table th {
    text-align: left; padding: 8px 10px;
    font-size: 10px; font-weight: 700; text-transform: uppercase;
    letter-spacing: .07em; color: var(--gray-400);
    border-bottom: 2px solid var(--gray-100); white-space: nowrap;
  }
  .gap-table td { padding: 8px 10px; border-bottom: 1px solid var(--gray-50); vertical-align: middle; }
  .gap-table tr:last-child td { border-bottom: none; }
  .gap-table tr.gap-within { background: #f0fdf4; }
  .gap-table tr.gap-outside { background: #fff1f2; }
  .gap-table tr.gap-negative { background: #fefce8; }
  .gap-table tr.gap-missing { background: #f9fafb; }

  .gap-order-link { color: var(--primary); font-weight: 600; text-decoration: none; }
  .gap-order-link:hover { text-decoration: underline; }

  .gap-dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 5px; vertical-align: middle; flex-shrink: 0; }
  .gap-dot.verified   { background: #16a34a; }
  .gap-dot.unverified { background: #eab308; }

  .gap-date-cell { display: flex; align-items: center; white-space: nowrap; }
  .gap-days { font-weight: 700; font-size: 12px; }
  .gap-days.within  { color: #16a34a; }
  .gap-days.outside { color: #dc2626; }
  .gap-days.negative { color: #92400e; }
  .gap-days.none { color: var(--gray-400); }

  .gap-legend { display: flex; flex-direction: column; gap: 4px; padding: 10px 14px; border-top: 1px solid var(--gray-100); }
  .gap-legend-row { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
  .gap-legend-item { display: flex; align-items: center; gap: 5px; font-size: 11px; color: var(--gray-600); }
  .gap-legend-swatch { width: 14px; height: 14px; border-radius: 3px; border: 1px solid rgba(0,0,0,.08); }
  .gap-legend-swatch.within   { background: #f0fdf4; }
  .gap-legend-swatch.outside  { background: #fff1f2; }
  .gap-legend-swatch.negative { background: #fefce8; }
  .gap-tolerance-note { font-size: 11px; color: var(--gray-400); margin-left: auto; }


  .gap-analysis-card .card-header { cursor: pointer; user-select: none; }
  .gap-analysis-card .card-header:hover { background: var(--gray-50); }
  .gap-collapse-chevron {
    margin-left: auto; font-size: 11px; color: var(--gray-400);
    transition: transform .2s; display: inline-block;
  }
  .gap-analysis-card.collapsed .gap-collapse-chevron { transform: rotate(-90deg); }
  .gap-collapse-body { overflow: hidden; }
  .gap-analysis-card.collapsed .gap-collapse-body { display: none; }


  /* ── REQUESTER BAR ── */
  .requester-bar {
    background: #fff;
    border: 1px solid var(--gray-200);
    border-radius: 10px;
    margin-bottom: 16px;
    overflow: hidden;
    box-shadow: 0 1px 4px rgba(0,0,0,.05);
  }
  .requester-bar-header {
    display: flex; align-items: center; gap: 10px;
    padding: 8px 14px;
    background: var(--primary);
    cursor: pointer; user-select: none;
  }
  .requester-bar-header:hover { background: var(--primary-dark); }
  .requester-bar-title { font-size: 12px; font-weight: 700; color: #fff; }
  .requester-bar-chevron { font-size: 10px; color: rgba(255,255,255,.8); transition: transform .2s; }
  .requester-bar.collapsed .requester-bar-chevron { transform: rotate(-90deg); }
  .requester-bar-body {
    display: flex; align-items: center; flex-wrap: wrap;
    gap: 0; overflow: hidden;
  }
  .requester-bar.collapsed .requester-bar-body { display: none; }
  .req-field {
    display: flex; flex-direction: column; gap: 1px;
    padding: 8px 14px;
    border-right: 1px solid var(--gray-100);
  }
  .req-field:last-child { border-right: none; }
  .req-label { font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: .06em; color: var(--gray-400); white-space: nowrap; }
  .req-val { font-size: 12px; font-weight: 700; color: var(--gray-800); white-space: nowrap; }


  /* ── SIDEBAR COLLAPSE ── */
  .sidebar-toggle-btn {
    position: fixed;
    top: 50vh;
    left: calc(var(--sidebar-width) - 12px);
    width: 20px; height: 36px;
    background: #fff;
    border: 1px solid var(--gray-200);
    border-radius: 0 6px 6px 0;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    font-size: 9px; color: var(--gray-400);
    box-shadow: 2px 0 6px rgba(0,0,0,.08);
    transition: left .25s;
    z-index: 101;
    user-select: none;
  }
  .sidebar-toggle-btn:hover { background: var(--gray-50); color: var(--gray-600); }

  body.sidebar-collapsed .sidebar-toggle-btn {
    left: 0px;
  }
  body.sidebar-collapsed .sidebar {
    transform: translateX(calc(-1 * var(--sidebar-width)));
  }
  body.sidebar-collapsed .main {
    margin-left: 0;
  }
  body.sidebar-collapsed .layout .sidebar {
    position: fixed;
  }
  body.sidebar-collapsed .sidebar-toggle-btn { color: var(--gray-500); }
  .sidebar { transition: transform .25s ease; }
  .main { transition: margin-left .25s ease; }


  /* ── ACCOUNT NOTES BAR ── */
  .account-notes-bar {
    background: #fffbeb;
    border: 1px solid #fde68a;
    border-top: none;
    border-radius: 0 0 8px 8px;
    margin-bottom: 0;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0,0,0,.06);
    position: sticky;
    top: 0;
    z-index: 89;
  }
  .account-notes-header {
    display: flex; align-items: center; gap: 8px;
    padding: 8px 14px;
    background: #fef3c7;
    border-bottom: 1px solid #fde68a;
    cursor: pointer; user-select: none;
  }
  .account-notes-header:hover { background: #fde68a; }
  .account-notes-chevron { font-size: 10px; color: #92400e; transition: transform .2s; }
  .account-notes-bar.collapsed .account-notes-chevron { transform: rotate(-90deg); }
  .account-notes-title { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: .07em; color: #92400e; }
  .account-notes-body { padding: 10px 16px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
  .account-notes-bar.collapsed .account-notes-body { display: none !important; }
  .acct-note-block { min-width: 0; }
  .acct-note-label {
    font-size: 10px; font-weight: 700; text-transform: uppercase;
    letter-spacing: .07em; color: #b45309; margin-bottom: 4px;
  }
  .acct-note-text { font-size: 12px; color: #78350f; line-height: 1.6; }
  .acct-note-text ul { margin: 4px 0 0 16px; padding: 0; }
  .acct-note-text li { margin-bottom: 2px; }
  .acct-note-pill {
    display: inline-block; padding: 2px 8px; border-radius: 20px;
    font-size: 11px; font-weight: 600; margin: 2px 3px 2px 0;
    background: #fef3c7; border: 1px solid #fde68a; color: #92400e;
  }


  /* ── ACCOUNT NOTES LOCK ── */
  .acct-notes-lock-btn {
    margin-left: auto;
    background: none; border: none; cursor: pointer;
    font-size: 14px; padding: 0 4px;
    color: #b45309; opacity: 0.5;
    transition: opacity .15s;
    line-height: 1;
  }
  .acct-notes-lock-btn:hover { opacity: 1; }
  .acct-notes-lock-btn.locked { opacity: 1; color: #92400e; }
  .account-notes-bar.locked-top {
    position: sticky;
    top: 0;
    z-index: 50;
    box-shadow: 0 3px 10px rgba(0,0,0,.1);
  }


  /* ── CHARGE-FIRST CRIMINAL RECORDS ── */
  .charge-block {
    border: 1px solid var(--gray-200);
    border-radius: 8px;
    margin-bottom: 12px;
    overflow: hidden;
  }
  .charge-header {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 14px;
    background: var(--gray-50);
    border-bottom: 1px solid var(--gray-200);
    cursor: pointer; user-select: none;
  }
  .charge-header:hover { background: #f0f4ff; }
  .charge-title { font-weight: 700; font-size: 13px; color: var(--gray-900); }
  .charge-chevron { font-size: 9px; color: var(--gray-400); transition: transform .15s; margin-right: 4px; }
  .charge-block.expanded .charge-chevron { transform: rotate(90deg); }
  .charge-body { display: none; }
  .charge-block.expanded .charge-body { display: block; }

  .case-block {
    border-bottom: 1px solid var(--gray-100);
  }
  .case-block:last-child { border-bottom: none; }

  .case-header {
    display: flex; align-items: center; flex-wrap: wrap; gap: 6px;
    padding: 10px 14px 6px;
    background: #fff;
    cursor: pointer;
  }
  .case-header:hover { background: #fafafa; }
  .case-num { font-size: 12px; font-weight: 700; color: var(--primary); }
  .case-meta { font-size: 11px; color: var(--gray-500); }
  .case-show-chk { display: flex; align-items: center; gap: 5px; font-size: 11px; color: var(--gray-600); margin-left: auto; }
  .case-show-chk input { cursor: pointer; }

  .case-detail { display: none; padding: 0 14px 12px; background: #fff; }
  .case-block.open .case-detail { display: block; }
  .case-block.open .case-header { background: #f8faff; }

  .defendant-row {
    display: flex; align-items: flex-start; gap: 14px;
    padding: 10px 0 8px;
    border-bottom: 1px solid var(--gray-100);
    margin-bottom: 8px;
  }
  .mugshot-placeholder {
    width: 64px; height: 80px; flex-shrink: 0;
    background: var(--gray-200); border-radius: 4px;
    display: flex; align-items: center; justify-content: center;
    font-size: 10px; color: var(--gray-400); text-align: center;
    font-style: italic;
  }
  .defendant-fields { flex: 1; display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px 16px; }
  .def-field { font-size: 11px; }
  .def-label { color: var(--gray-500); display: inline; }
  .def-val { color: var(--primary); font-weight: 600; display: inline; margin-left: 4px; }

  .identifiers-row {
    font-size: 11px; color: var(--gray-600);
    padding: 6px 0; border-bottom: 1px solid var(--gray-100);
    margin-bottom: 8px;
  }
  .identifiers-row label { display: inline-flex; align-items: center; gap: 4px; margin-right: 12px; }
  .addl-identifiers { color: var(--primary); font-weight: 600; margin-top: 3px; font-size: 11px; }

  .case-info-grid {
    display: grid; grid-template-columns: repeat(3, 1fr);
    gap: 4px 16px; font-size: 11px;
    padding: 8px 0; border-bottom: 1px solid var(--gray-100);
    margin-bottom: 8px;
  }
  .ci-field { }
  .ci-label { color: var(--gray-500); }
  .ci-val { color: var(--primary); font-weight: 600; margin-left: 4px; }
  .ci-val.plain { color: var(--gray-700); font-weight: 400; }

  .case-comments { font-size: 11px; color: var(--gray-500); margin-bottom: 6px; }
  .case-comments span { color: var(--primary); font-weight: 500; }

  .charge-detail-section {
    border: 1px solid var(--gray-100);
    border-radius: 6px; margin-bottom: 10px; overflow: hidden;
  }
  .charge-detail-header {
    background: var(--gray-50); padding: 6px 12px;
    font-size: 11px; font-weight: 700; text-transform: uppercase;
    letter-spacing: .06em; color: var(--gray-500);
    border-bottom: 1px solid var(--gray-100);
    display: flex; align-items: center; justify-content: space-between;
  }
  .charge-detail-grid {
    display: grid; grid-template-columns: repeat(3, 1fr);
    gap: 4px 16px; font-size: 11px; padding: 8px 12px;
  }
  .cd-field { }
  .cd-label { color: var(--gray-500); }
  .cd-val { color: var(--primary); font-weight: 600; margin-left: 4px; }

  .sentencing-table-wrap { overflow-x: auto; }
  .sentencing-table {
    width: 100%; border-collapse: collapse; font-size: 11px;
    margin-top: 4px;
  }
  .sentencing-table th {
    text-align: left; padding: 5px 10px;
    background: var(--gray-50); border-bottom: 2px solid var(--gray-200);
    font-weight: 700; color: var(--gray-500); font-size: 10px;
    text-transform: uppercase; letter-spacing: .05em;
  }
  .sentencing-table td { padding: 5px 10px; border-bottom: 1px solid var(--gray-50); }
  .sentencing-table tr:last-child td { border-bottom: none; }
  .sentencing-table .sent-val { color: var(--primary); font-weight: 600; }
  .sentencing-comment { font-size: 11px; color: var(--gray-500); padding: 4px 0; }
  .sentencing-comment span { color: var(--primary); font-weight: 500; }

  /* Edit modal */
  .edit-field-btn {
    background: none; border: 1px solid var(--gray-200); border-radius: 4px;
    padding: 2px 7px; font-size: 10px; cursor: pointer;
    color: var(--primary); font-family: var(--font); font-weight: 600;
    margin-left: 6px; transition: all .12s;
  }
  .edit-field-btn:hover { background: var(--primary); color: #fff; border-color: var(--primary); }

  .record-edit-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,.45); z-index: 300;
    align-items: center; justify-content: center;
  }
  .record-edit-overlay.open { display: flex; }
  .record-edit-modal {
    background: #fff; border-radius: 12px;
    padding: 24px 28px; width: 560px; max-width: 95vw;
    max-height: 80vh; overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0,0,0,.25);
  }
  .rem-title { font-size: 15px; font-weight: 700; color: var(--gray-900); margin-bottom: 16px; }
  .rem-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .rem-field label { display: block; font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: .07em; color: var(--gray-400); margin-bottom: 4px; }
  .rem-field input, .rem-field select, .rem-field textarea {
    width: 100%; padding: 7px 10px; border: 1.5px solid var(--gray-200);
    border-radius: 6px; font-size: 12px; font-family: var(--font);
    color: var(--gray-800); box-sizing: border-box;
  }
  .rem-field textarea { resize: vertical; min-height: 60px; }
  .rem-field input:focus, .rem-field select:focus { outline: none; border-color: var(--primary); }
  .rem-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 18px; }
  .rem-save-btn { padding: 8px 18px; background: var(--primary); color: #fff; border: none; border-radius: 7px; font-size: 13px; font-weight: 600; cursor: pointer; font-family: var(--font); }
  .rem-save-btn:hover { background: var(--primary-dark); }
  .rem-cancel-btn { padding: 8px 18px; background: #fff; color: var(--gray-600); border: 1.5px solid var(--gray-200); border-radius: 7px; font-size: 13px; font-weight: 600; cursor: pointer; font-family: var(--font); }
  .rem-cancel-btn:hover { background: var(--gray-50); }
  .rem-move-note { font-size: 11px; color: var(--gray-400); margin-top: 10px; font-style: italic; }

</style>
</head>
<body>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- HEADER -->
<header class="header">
  <div class="header-logo">
    <div class="dot"></div>
    CRA Portal
  </div>
  <div class="header-divider"></div>
  <div class="header-report-info">
    <div class="header-report-name">BAD, JOHNNY (95682)</div>
    <div class="header-report-sub">RPT-2024-04812 &nbsp;·&nbsp; Ordered: 02/14/2024</div>
  </div>
  <div class="header-spacer"></div>
  <div class="header-status-badge">
    <div class="pulse"></div>
    In Progress
  </div>
  <button class="header-btn">Print HTML Report</button>
</header>


<!-- QUEUE CONTEXT BANNER -->
<div class="queue-banner hidden" id="queueBanner">
  <span style="font-size:14px;">⚡</span>
  <span class="qb-text" id="qbText">Criminal Records Queue</span>
  <span class="qb-detail" id="qbDetail">Manage Backlog › Criminal Records › RPT-2024-04812</span>
  <div class="qb-spacer"></div>
  <div class="qb-nav">
    <span class="qb-pos" id="qbPos">3 of 12 in queue</span>
    <button class="qb-arrow" id="qbPrev" onclick="queueNav(-1)" title="Previous">‹</button>
    <button class="qb-arrow" id="qbNext" onclick="queueNav(1)" title="Next">›</button>
    <button class="qb-back" onclick="goBackToQueue()">← Back to Queue</button>
  </div>
</div>

<!-- LAYOUT -->
<div class="layout">

  <!-- SIDEBAR -->
  <nav class="sidebar">
    <div class="queue-mode-label" id="queueModeLabel">
      <span>⚡</span><span id="queueModeText">Queue Focus: Criminal</span>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-section-label">Overview</div>
      <div class="sidebar-item active" id="sidebar-overview" onclick="showPanel('overview', this)">
        <div class="sidebar-item-icon">📋</div>
        Report Summary
      </div>
    </div>

    <div class="sidebar-divider"></div>

    <div class="sidebar-section">
      <div class="sidebar-section-label">Searches</div>
      <div class="sidebar-group" id="group-criminal">
        <div class="sidebar-group-header queue-focused" id="sidebar-criminal"
             onclick="toggleSearchGroup('criminal', this, undefined, true)">
          <div class="sidebar-item-icon">🔍</div>
          Criminal Search
          <span class="sidebar-badge badge-hit sgr-badge">4</span>
          <span class="sgr-chevron">▶</span>
        </div>
        <div class="sidebar-sublist" id="sublist-criminal">
          <div class="sidebar-subitem" id="subitem-crim-1" onclick="openSearchRecord('criminal','crim-1',this)">
            <div class="ssi-content">
              <div class="ssi-name">County Criminal</div>
              <div class="ssi-meta">Hays County, TX · (P) Wade Smith</div>
            </div>
            <span class="ssi-badge badge-hit">HIT</span>
          </div>
          <div class="sidebar-subitem" id="subitem-crim-2" onclick="openSearchRecord('criminal','crim-2',this)">
            <div class="ssi-content">
              <div class="ssi-name">County Criminal</div>
              <div class="ssi-meta">Travis County, TX · (P) Wade Smith</div>
            </div>
            <span class="ssi-badge badge-pending">PEND</span>
          </div>
          <div class="sidebar-subitem" id="subitem-crim-3" onclick="openSearchRecord('criminal','crim-3',this)">
            <div class="ssi-content">
              <div class="ssi-name">County Criminal</div>
              <div class="ssi-meta">Hays County, TX · (A) Wade Smity</div>
            </div>
            <span class="ssi-badge badge-clear">CLR</span>
          </div>
          <div class="sidebar-subitem" id="subitem-crim-4" onclick="openSearchRecord('criminal','crim-4',this)">
            <div class="ssi-content">
              <div class="ssi-name">County Criminal</div>
              <div class="ssi-meta">Travis County, TX · (A) Wade Smity</div>
            </div>
            <span class="ssi-badge badge-clear">CLR</span>
          </div>
        </div>
      </div>
      <div class="sidebar-group" id="group-employment">
        <div class="sidebar-group-header queue-hidden" id="sidebar-employment"
             onclick="toggleSearchGroup('employment', this, undefined, true)">
          <div class="sidebar-item-icon">💼</div>
          Employment Verif.
          <span class="sidebar-badge badge-pending sgr-badge">2</span>
          <span class="sgr-chevron">▶</span>
        </div>
        <div class="sidebar-sublist" id="sublist-employment">
          <div class="sidebar-subitem" id="subitem-emp-1" onclick="openSearchRecord('employment','emp-1',this)">
            <div class="ssi-content">
              <div class="ssi-name">Employment Verification</div>
              <div class="ssi-meta">UT of Austin · (P) Wade Smith</div>
            </div>
            <span class="ssi-badge badge-pending">PEND</span>
          </div>
          <div class="sidebar-subitem" id="subitem-emp-2" onclick="openSearchRecord('employment','emp-2',this)">
            <div class="ssi-content">
              <div class="ssi-name">Employment Verification</div>
              <div class="ssi-meta">UT of Austin · (A) Wade Smity</div>
            </div>
            <span class="ssi-badge badge-clear">CLR</span>
          </div>
        </div>
      </div>
      <div class="sidebar-group" id="group-mvr">
        <div class="sidebar-group-header queue-hidden" id="sidebar-mvr"
             onclick="toggleSearchGroup('mvr', this, undefined, true)">
          <div class="sidebar-item-icon">🚗</div>
          MVR
          <span class="sidebar-badge badge-review sgr-badge">1</span>
          <span class="sgr-chevron">▶</span>
        </div>
        <div class="sidebar-sublist" id="sublist-mvr">
          <div class="sidebar-subitem" id="subitem-mvr-1" onclick="openSearchRecord('mvr','mvr-1',this)">
            <div class="ssi-content">
              <div class="ssi-name">Motor Vehicle Record</div>
              <div class="ssi-meta">Texas DPS · (P) Wade Smith</div>
            </div>
            <span class="ssi-badge badge-review">REV</span>
          </div>
        </div>
      </div>
      <div class="sidebar-group" id="group-education">
        <div class="sidebar-group-header queue-hidden" id="sidebar-education"
             onclick="toggleSearchGroup('education', this, undefined, true)">
          <div class="sidebar-item-icon">🎓</div>
          Education Verif.
          <span class="sidebar-badge badge-clear sgr-badge">1</span>
          <span class="sgr-chevron">▶</span>
        </div>
        <div class="sidebar-sublist" id="sublist-education">
          <div class="sidebar-subitem" id="subitem-edu-1" onclick="openSearchRecord('education','edu-1',this)">
            <div class="ssi-content">
              <div class="ssi-name">Education Verification</div>
              <div class="ssi-meta">UT of Austin · (P) Wade Smith</div>
            </div>
            <span class="ssi-badge badge-clear">CLR</span>
          </div>
        </div>
      </div>
    </div>


  </nav>

  <!-- MAIN -->
  
<button class="sidebar-toggle-btn" id="sidebarToggle" onclick="toggleSidebar()" title="Toggle sidebar">◀</button>
<main class="main">

    <!-- ══ PERSISTENT SUBJECT BAR (always visible) ══ -->
    <div class="subject-bar" id="subjectBar">
      <div class="subject-bar-inner">
        <div class="subject-bar-avatar">JB</div>
        <div class="subject-bar-fields">
          <div class="subject-bar-row">
            <div class="sb-field">
              <div class="sb-label">Full Name</div>
              <div class="sb-val sb-name">BAD, JOHNNY V.</div>
            </div>
            <div class="sb-sep"></div>
            <div class="sb-field">
              <div class="sb-label">SSN</div>
              <div class="sb-val sb-sensitive">XXX-XX-9999</div>
            </div>
            <div class="sb-sep"></div>
            <div class="sb-field">
              <div class="sb-label">Date of Birth</div>
              <div class="sb-val">01/01/1980 <span class="sb-muted">(44)</span></div>
            </div>
            <div class="sb-sep"></div>
            <div class="sb-field">
              <div class="sb-label">Phone</div>
              <div class="sb-val">555-555-5555</div>
            </div>
            <div class="sb-sep"></div>
            <div class="sb-field">
              <div class="sb-label">Email</div>
              <div class="sb-val"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="dab0b8bbbe9abfa2bbb7aab6bff4b9b5b7">[email&#160;protected]</a></div>
            </div>
            <div class="sb-sep"></div>
            <div class="sb-field">
              <div class="sb-label">Address</div>
              <div class="sb-val">225 Smooth St, Dripping Springs TX 78620</div>
            </div>
            <div class="sb-sep"></div>
            <div class="sb-field">
              <div class="sb-label">Gender</div>
              <div class="sb-val">Male</div>
            </div>
            <div class="sb-sep"></div>
            <div class="sb-field">
              <div class="sb-label">Race</div>
              <div class="sb-val sb-muted">—</div>
            </div>
            <div class="sb-sep"></div>
            <div class="sb-field">
              <div class="sb-label">Height / Weight</div>
              <div class="sb-val">5'09" / 175 lbs</div>
            </div>
            <div class="sb-sep"></div>
            <div class="sb-field">
              <div class="sb-label">Hair / Eyes</div>
              <div class="sb-val">Red / Hazel</div>
            </div>
            <div class="sb-sep"></div>
            <div class="sb-field">
              <div class="sb-label">OLN / State</div>
              <div class="sb-val">123-456-789 <span class="sb-muted">TX</span></div>
            </div>
            <div class="sb-sep"></div>
            <div class="sb-field">
              <div class="sb-label">Job Title</div>
              <div class="sb-val">Employment By Place of Content</div>
            </div>
          </div>
        </div>
        <div class="subject-bar-collapsed-label">
          <span class="sb-collapsed-name">BAD, JOHNNY V.</span>
          <span class="sb-collapsed-details">SSN: XXX-XX-9999 &nbsp;·&nbsp; DOB: 01/01/1980 &nbsp;·&nbsp; RPT-2024-04812</span>
        </div>
        <button class="sb-collapse-btn" id="sbCollapseBtn" onclick="toggleSubjectBar()" title="Collapse subject bar">▲</button>
      </div>
    </div>



    <!-- ══ ACCOUNT NOTES BAR ══ -->
    <div class="account-notes-bar collapsed" id="accountNotesBar">
      <div class="account-notes-header" onclick="toggleAccountNotes(event)">
        <span class="account-notes-chevron">▼</span>
        <span class="account-notes-title">📋 Account Notes</span>
        <span style="font-size:11px;color:#b45309;margin-left:8px;font-weight:500;">hcrally/admin · Hill Country Rally for Kids</span>
        <button class="acct-notes-lock-btn" id="acctNotesLock" onclick="toggleAccountNotesLock(event)" title="Pin to top">🔓</button>
      </div>
      <div class="account-notes-body">
        <div class="acct-note-block">
          <div class="acct-note-label">Search Instructions</div>
          <div class="acct-note-text">
            <ul>
              <li>Run county criminal for all counties of residence for the past <strong>7 years</strong></li>
              <li>Include federal district court search for all applicable jurisdictions</li>
              <li>Run statewide criminal where available</li>
              <li>Gap tolerance is <strong>60 days</strong> — flag anything beyond this</li>
            </ul>
          </div>
        </div>
        <div class="acct-note-block">
          <div class="acct-note-label">Package</div>
          <div class="acct-note-text">
            <span class="acct-note-pill">Cody / A La Carte</span>
            <span class="acct-note-pill">#years = 7</span>
            <span class="acct-note-pill">Gap Tolerance = 60 days</span>
          </div>
          <div class="acct-note-label" style="margin-top:10px;">Verifications</div>
          <div class="acct-note-text">Verify employment and education going back 7 years. Contact employer directly if applicant-provided dates cannot be confirmed. Request signed release if unresponsive.</div>
        </div>
        <div class="acct-note-block">
          <div class="acct-note-label">Special Notes</div>
          <div class="acct-note-text">Client requires supervisor review for any HIT results before report is finalized. Do not release report until review is complete. Contact <strong>Hank Jones</strong> at <strong>444-999-9999</strong> with questions.</div>
        </div>
      </div>
    </div>

    <div class="main-panel-content">
    <!-- ══ OVERVIEW PANEL ══ -->
    <div class="panel active" id="panel-overview">
      <div class="breadcrumb">
        <span class="crumb active">Report Summary</span>
      </div>
      <div class="panel-header">
        <div class="panel-title-group">
          <div class="panel-title">Report Summary</div>
          <div class="panel-subtitle">BAD, JOHNNY &nbsp;·&nbsp; SSN: XXX-XX-9999 &nbsp;·&nbsp; DOB: 01/01/1980</div>
        </div>
      </div>

      <!-- Stat Cards -->
      <div class="overview-stats">
        <div class="stat-card accent-orange">
          <div class="stat-label">Searches Total</div>
          <div class="stat-value">4</div>
          <div class="stat-sub">All services</div>
        </div>
        <div class="stat-card accent-red">
          <div class="stat-label">Hits / Flags</div>
          <div class="stat-value">2</div>
          <div class="stat-sub">Require review</div>
        </div>
        <div class="stat-card accent-blue">
          <div class="stat-label">Pending</div>
          <div class="stat-value">1</div>
          <div class="stat-sub">Awaiting response</div>
        </div>
        <div class="stat-card accent-green">
          <div class="stat-label">Clear</div>
          <div class="stat-value">1</div>
          <div class="stat-sub">No issues found</div>
        </div>
      </div>

      <!-- Subject Info -->
      <div class="card" style="margin-bottom:16px;">
        <div class="card-header">
          <div class="card-header-title">▸ Subject Information</div>
        </div>
        <div class="card-body">
          <div class="subject-grid">
            <div class="subject-field"><label>Full Name</label><div class="val">BAD, JOHNNY V.</div></div>
            <div class="subject-field"><label>SSN</label><div class="val">XXX-XX-9999</div></div>
            <div class="subject-field"><label>Date of Birth</label><div class="val">01/01/1980 (44)</div></div>
            <div class="subject-field"><label>Address</label><div class="val">225 SMOOTH STREET, Dripping Springs, TX 78620</div></div>
            <div class="subject-field"><label>Phone</label><div class="val">555-555-5555</div></div>
            <div class="subject-field"><label>Email</label><div class="val"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a3c9c1c2c7e3c6dbc2ced3cfc68dc0ccce">[email&#160;protected]</a></div></div>
            <div class="subject-field"><label>Job Title</label><div class="val">Employment By Place of Content</div></div>
            <div class="subject-field"><label>Race</label><div class="val">—</div></div>
            <div class="subject-field"><label>Gender</label><div class="val">Male</div></div>
          </div>
        </div>
      </div>

      <!-- Searches Summary Table -->
      <div class="card">
        <div class="card-header">
          <div class="card-header-title">▸ Searches</div>
          <div class="card-header-spacer"></div>
          <span style="font-size:11px;color:var(--gray-400);">Click a search to open it</span>
        </div>
        <div class="card-body" style="padding:0;">
          <table class="searches-table">
            <thead>
              <tr>
                <th>Search Type</th>
                <th>Jurisdiction / Subject</th>
                <th>Status</th>
                <th>Disposition</th>
                <th>Last Updated</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>Criminal Search</strong><div class="record-sub">County Criminal Report</div></td>
                <td>Travis County, TX</td>
                <td><span class="status-pill hit"><span class="dot"></span>Hit</span></td>
                <td>Pending Review</td>
                <td>02/15/2024</td>
                <td><button class="open-btn" onclick="showPanel('criminal', document.querySelector('.sidebar-item:nth-of-type(3)'))">Open →</button></td>
              </tr>
              <tr>
                <td><strong>Employment Verif.</strong><div class="record-sub">UT of Austin</div></td>
                <td>Austin, TX</td>
                <td><span class="status-pill pending"><span class="dot"></span>Pending</span></td>
                <td>In Progress</td>
                <td>02/14/2024</td>
                <td><button class="open-btn" onclick="showPanel('employment', document.querySelector('.sidebar-item:nth-of-type(4)'))">Open →</button></td>
              </tr>
              <tr>
                <td><strong>MVR</strong><div class="record-sub">Motor Vehicle Record</div></td>
                <td>Texas DPS</td>
                <td><span class="status-pill review"><span class="dot"></span>Review</span></td>
                <td>Violations Found</td>
                <td>02/14/2024</td>
                <td><button class="open-btn" onclick="showPanel('mvr', document.querySelector('.sidebar-item:nth-of-type(5)'))">Open →</button></td>
              </tr>
              <tr>
                <td><strong>Education Verif.</strong><div class="record-sub">UT of Austin</div></td>
                <td>Austin, TX</td>
                <td><span class="status-pill clear"><span class="dot"></span>Clear</span></td>
                <td>Verified</td>
                <td>02/14/2024</td>
                <td><button class="open-btn" onclick="showPanel('education', document.querySelector('.sidebar-item:nth-of-type(6)'))">Open →</button></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ══ CRIMINAL SEARCH LIST PANEL ══ -->
    <div class="panel" id="panel-criminal-list">
      <div class="breadcrumb">
        <span class="crumb" onclick="showPanel('overview', document.getElementById('sidebar-overview'))">Report Summary</span>
        <span class="sep">›</span>
        <span class="crumb active">Criminal Search</span>
      </div>
      <div class="panel-header">
        <div class="panel-title-group">
          <div class="panel-title">Criminal Search</div>
          <div class="panel-subtitle">4 searches across 2 jurisdictions — Primary &amp; Alias names</div>
        </div>
      </div>

      <div class="search-list-section-label">Primary Name — Wade Smith</div>
      <div class="search-list-grid">
        <div class="search-list-card status-hit" onclick="openSearchRecord('criminal','crim-1', document.getElementById('subitem-crim-1'))">
          <div class="slc-icon">🔍</div>
          <div class="slc-main">
            <div class="slc-type">County Criminal</div>
            <div class="slc-jurisdiction">Hays County, TX</div>
            <div class="slc-name-tag">(P) Wade Smith</div>
          </div>
          <div class="slc-meta">
            <div class="slc-meta-item"><div class="slc-meta-label">Order #</div><div class="slc-meta-val">F-04812</div></div>
            <div class="slc-meta-item"><div class="slc-meta-label">Fill Status</div><div class="slc-meta-val">In Progress</div></div>
            <div class="slc-meta-item"><div class="slc-meta-label">Filled Code</div><div class="slc-meta-val" style="color:var(--danger);font-weight:700;">Hits</div></div>
          </div>
          <span class="status-pill hit" style="flex-shrink:0;"><span class="dot"></span>Hit</span>
          <button class="slc-open-btn" onclick="event.stopPropagation();openSearchRecord('criminal','crim-1',document.getElementById('subitem-crim-1'))">Open →</button>
        </div>
        <div class="search-list-card status-pending" onclick="openSearchRecord('criminal','crim-2', document.getElementById('subitem-crim-2'))">
          <div class="slc-icon">🔍</div>
          <div class="slc-main">
            <div class="slc-type">County Criminal</div>
            <div class="slc-jurisdiction">Travis County, TX</div>
            <div class="slc-name-tag">(P) Wade Smith</div>
          </div>
          <div class="slc-meta">
            <div class="slc-meta-item"><div class="slc-meta-label">Order #</div><div class="slc-meta-val">F-04813</div></div>
            <div class="slc-meta-item"><div class="slc-meta-label">Fill Status</div><div class="slc-meta-val">In Progress</div></div>
            <div class="slc-meta-item"><div class="slc-meta-label">Filled Code</div><div class="slc-meta-val" style="color:var(--gray-400);">Unknown</div></div>
          </div>
          <span class="status-pill pending" style="flex-shrink:0;"><span class="dot"></span>Pending</span>
          <button class="slc-open-btn" onclick="event.stopPropagation();openSearchRecord('criminal','crim-2',document.getElementById('subitem-crim-2'))">Open →</button>
        </div>
      </div>

      <div class="search-list-section-label" style="margin-top:4px;">Alias Name — Wade Smity</div>
      <div class="search-list-grid">
        <div class="search-list-card status-clear" onclick="openSearchRecord('criminal','crim-3', document.getElementById('subitem-crim-3'))">
          <div class="slc-icon">🔍</div>
          <div class="slc-main">
            <div class="slc-type">County Criminal</div>
            <div class="slc-jurisdiction">Hays County, TX</div>
            <div class="slc-name-tag"><span class="alias-dot"></span>(A) Wade Smity</div>
          </div>
          <div class="slc-meta">
            <div class="slc-meta-item"><div class="slc-meta-label">Order #</div><div class="slc-meta-val">F-04814</div></div>
            <div class="slc-meta-item"><div class="slc-meta-label">Fill Status</div><div class="slc-meta-val">Complete</div></div>
            <div class="slc-meta-item"><div class="slc-meta-label">Filled Code</div><div class="slc-meta-val" style="color:var(--success);font-weight:700;">Clear</div></div>
          </div>
          <span class="status-pill clear" style="flex-shrink:0;"><span class="dot"></span>Clear</span>
          <button class="slc-open-btn" onclick="event.stopPropagation();openSearchRecord('criminal','crim-3',document.getElementById('subitem-crim-3'))">Open →</button>
        </div>
        <div class="search-list-card status-clear" onclick="openSearchRecord('criminal','crim-4', document.getElementById('subitem-crim-4'))">
          <div class="slc-icon">🔍</div>
          <div class="slc-main">
            <div class="slc-type">County Criminal</div>
            <div class="slc-jurisdiction">Travis County, TX</div>
            <div class="slc-name-tag"><span class="alias-dot"></span>(A) Wade Smity</div>
          </div>
          <div class="slc-meta">
            <div class="slc-meta-item"><div class="slc-meta-label">Order #</div><div class="slc-meta-val">F-04815</div></div>
            <div class="slc-meta-item"><div class="slc-meta-label">Fill Status</div><div class="slc-meta-val">Complete</div></div>
            <div class="slc-meta-item"><div class="slc-meta-label">Filled Code</div><div class="slc-meta-val" style="color:var(--success);font-weight:700;">Clear</div></div>
          </div>
          <span class="status-pill clear" style="flex-shrink:0;"><span class="dot"></span>Clear</span>
          <button class="slc-open-btn" onclick="event.stopPropagation();openSearchRecord('criminal','crim-4',document.getElementById('subitem-crim-4'))">Open →</button>
        </div>
      </div>
    </div>

    <!-- ══ CRIMINAL SEARCH PANEL ══ -->
    <div class="panel" id="panel-criminal">
      <div class="breadcrumb">
        <span class="crumb" onclick="showPanel('overview', document.getElementById('sidebar-overview'))">Report Summary</span>
        <span class="sep">›</span>
        <span class="crumb" onclick="toggleSearchGroup('criminal', document.getElementById('sidebar-criminal'), true, true)">Criminal Search</span>
        <span class="sep">›</span>
        <span class="crumb active" id="criminal-record-breadcrumb">County Criminal — Hays County, TX</span>
      </div>
      <div class="panel-header">
        <div class="panel-title-group">
          <div class="panel-title" id="criminal-record-title">County Criminal — Hays County, TX</div>
          <div class="panel-subtitle">County Criminal Report &nbsp;·&nbsp; Travis County, TX</div>
        </div>
        <div class="panel-actions">
          <button class="view-history-btn" onclick="openHistory('criminal')"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><path d="M8 5v3.5l2 1.5"/></svg> View History</button>
        </div>
      </div>

      <!-- Fill Status Bar -->
      <div class="fill-status-bar" id="fsbar-criminal">
        <div class="fsb-col">
          <div class="fsb-col-label">Order #</div>
          <div class="fsb-col-val">F-04812</div>
        </div>
        <div class="fsb-col">
          <div class="fsb-col-label">Jurisdiction</div>
          <div class="fsb-col-val">Hays County, TX</div>
        </div>
        <div class="fsb-col">
          <div class="fsb-col-label">Filing Date</div>
          <div class="fsb-col-val">03/17/2013</div>
        </div>
        <div class="fsb-col">
          <div class="fsb-col-label">Search Type</div>
          <div class="fsb-col-val">County Criminal</div>
        </div>
        <div class="fsb-col fsb-status-col">
          <div class="fsb-col-label"><span class="fsb-required"></span>Fill Status</div>
          <select class="fsb-select status-inprogress" id="fillStatus-criminal" onchange="onFillStatusChange('criminal', this)">
            <option value="in progress" selected>In Progress</option>
            <option value="complete" >Complete</option>
          </select>
        </div>
        <div class="fsb-col fsb-status-col">
          <div class="fsb-col-label"><span class="fsb-required"></span>Filled Code</div>
          <select class="fsb-select code-unknown" id="filledCode-criminal" onchange="onFilledCodeChange('criminal', this)">
            <option value="unknown" selected>Unknown</option>
            <option value="clear" >Clear</option>
            <option value="hits" >Hits</option>
          </select>
        </div>
        <div class="fsb-save-col">
          <button class="fsb-save-btn" onclick="saveStatus('criminal')">Save</button>
          <span class="fsb-saved-indicator" id="fsbSaved-criminal">✓ Saved</span>
        </div>
      </div>
      <div class="content-with-actions">
        <div>
          <!-- Tab Bar -->
          <div class="tab-bar">
            <div class="tab active" onclick="switchTab(this,'tab-records')">Records</div>
            <div class="tab" onclick="switchTab(this,'tab-subject-detail')">Subject Details</div>
            <div class="tab" onclick="switchTab(this,'tab-case-notes')">Case Notes</div>
          </div>

          <!-- Tab: Records -->
          <div <div id="tab-records" class="card">
            <div class="card-header">
              <div class="card-header-title">▸ Criminal Records</div>
              <div class="card-header-spacer"></div>
              <span style="font-size:11px;color:var(--gray-400);">Select records to flag for re-verification</span>
              <button onclick="showToast('Selected records flagged for re-verification.')" style="margin-left:12px;padding:4px 10px;font-size:11px;background:var(--accent-light);color:var(--accent);border:1px solid #fed7aa;border-radius:5px;cursor:pointer;font-weight:600;font-family:var(--font);">Re-Verify Selected</button>
            </div>
            <div class="card-body" style="padding:12px;">

              <!-- ── CHARGE #1: Theft of Property ── -->
              <div class="charge-block expanded" id="charge-1">
                <div class="charge-header" onclick="toggleCharge('charge-1')">
                  <span class="charge-chevron">▶</span>
                  <span class="charge-title">Theft of Property</span>
                  <span class="tag misdemeanor" style="margin-left:6px;">Misdemeanor</span>
                  <span style="font-size:11px;color:var(--gray-400);margin-left:10px;">2 cases</span>
                  <div style="margin-left:auto;display:flex;gap:6px;align-items:center;">
                    <span class="status-pill hit" style="font-size:11px;"><span class="dot"></span>Guilty</span>
                    <select class="action-select" onclick="event.stopPropagation()" onchange="showToast('Action saved.')">
                      <option value="">Set Action...</option>
                      <option>Re-Verify</option>
                      <option>Accept Record</option>
                      <option>Dispute Record</option>
                      <option>Mark Reviewed</option>
                    </select>
                  </div>
                </div>
                <div class="charge-body">

                  <!-- Case 101010 -->
                  <div class="case-block open" id="case-101010">
                    <div class="case-header" onclick="toggleCase('case-101010')">
                      <span style="font-size:9px;color:var(--gray-400);margin-right:2px;">▶</span>
                      <span class="case-num">Case #101010</span>
                      <span class="case-meta">Court House &nbsp;·&nbsp; Travis County, TX</span>
                      <span style="font-size:11px;color:var(--gray-400);margin-left:8px;">03/23/2014</span>
                      <div class="case-show-chk" onclick="event.stopPropagation()">
                        <input type="checkbox" checked id="show-101010"> Show these results?
                      </div>
                      <button class="edit-field-btn" onclick="event.stopPropagation();openEditModal('case-101010','Theft of Property — Case #101010')">✎ Edit</button>
                    </div>
                    <div class="case-detail">
                      <!-- Defendant -->
                      <div class="defendant-row">
                        <div class="mugshot-placeholder">No<br>Photo</div>
                        <div class="defendant-fields">
                          <div class="def-field"><span class="def-label">Defendant:</span><span class="def-val">Johnny B Bad Sr</span></div>
                          <div class="def-field"><span class="def-label">SSN:</span><span class="def-val">123-45-6789</span></div>
                          <div class="def-field"><span class="def-label">Gender:</span><span class="def-val">M</span></div>
                          <div class="def-field"><span class="def-label">Address:</span><span class="def-val">111 No Place Dr., Anytown, TX 78749</span></div>
                          <div class="def-field"><span class="def-label">DOB:</span><span class="def-val">02/23/1958</span></div>
                          <div class="def-field"><span class="def-label">Race:</span><span class="def-val">W</span></div>
                          <div class="def-field"><span class="def-label">Height:</span><span class="def-val">70 inches</span></div>
                          <div class="def-field"><span class="def-label">Weight:</span><span class="def-val">195 pounds</span></div>
                          <div class="def-field"><span class="def-label">Hair:</span><span class="def-val">Green</span></div>
                          <div class="def-field"><span class="def-label">Eyes:</span><span class="def-val">Black</span></div>
                          <div class="def-field"><span class="def-label">Alias:</span><span class="def-val">John Bad Sr.</span></div>
                          <div class="def-field"><span class="def-label">Alias:</span><span class="def-val">John Badder Sr.</span></div>
                        </div>
                      </div>
                      <!-- Identifiers -->
                      <div class="identifiers-row">
                        <strong>Identified By:</strong>
                        <label><input type="checkbox" checked> name</label>
                        <label><input type="checkbox" checked> date of birth</label>
                        <label><input type="checkbox" checked> social security number</label>
                        <label><input type="checkbox"> partial social security number</label>
                        <div class="addl-identifiers">Additional Identifiers: Matched scar on left arm</div>
                      </div>
                      <!-- Case Info -->
                      <div class="case-info-grid">
                        <div class="ci-field"><span class="ci-label">Case Number:</span><span class="ci-val">101010</span></div>
                        <div class="ci-field"><span class="ci-label">Source:</span><span class="ci-val">Court House</span></div>
                        <div class="ci-field"><span class="ci-label">Source State:</span><span class="ci-val">TX</span></div>
                        <div class="ci-field"><span class="ci-label">Jurisdiction:</span><span class="ci-val">Travis County</span></div>
                        <div class="ci-field"><span class="ci-label">Offense Date:</span><span class="ci-val">03/23/2014</span></div>
                        <div class="ci-field"><span class="ci-label">Filing Date:</span><span class="ci-val">05/21/2014</span></div>
                        <div class="ci-field"><span class="ci-label">Disposition Date:</span><span class="ci-val">02/23/2015</span></div>
                        <div class="ci-field"><span class="ci-label">Pending Date:</span><span class="ci-val plain">—</span></div>
                      </div>
                      <div class="case-comments">Case comments: <span>This is test data</span></div>

                      <!-- Charge #1 Detail -->
                      <div class="charge-detail-section">
                        <div class="charge-detail-header">
                          Charge #1
                          <button class="edit-field-btn" onclick="openEditModal('charge-101010-1','Charge #1 — Dead Walking')">✎ Edit</button>
                        </div>
                        <div class="charge-detail-grid">
                          <div class="cd-field"><span class="cd-label">Charge:</span><span class="cd-val">Dead walking</span></div>
                          <div class="cd-field"><span class="cd-label">Crime Type:</span><span class="cd-val">Misdemeanor</span></div>
                          <div class="cd-field"><span class="cd-label">Disposition:</span><span class="cd-val">Guilty</span></div>
                          <div class="cd-field"><span class="cd-label">Statute:</span><span class="cd-val">CS12345</span></div>
                          <div class="cd-field"><span class="cd-label">Plea:</span><span class="cd-val">Not guilty</span></div>
                          <div class="cd-field"><span class="cd-label">Arrest Date:</span><span class="cd-val">March 23, 2013</span></div>
                          <div class="cd-field"><span class="cd-label">Offense Date:</span><span class="cd-val">March 23, 2013</span></div>
                          <div class="cd-field"><span class="cd-label">Filing Date:</span><span class="cd-val">March 24, 2013</span></div>
                          <div class="cd-field"><span class="cd-label">Sentencing Date:</span><span class="cd-val">February 23, 2014</span></div>
                          <div class="cd-field"><span class="cd-label">Disposition Date:</span><span class="cd-val">February 23, 2014</span></div>
                        </div>
                        <div class="case-comments" style="padding:4px 12px;">Charge comments: <span>This is test data</span></div>
                        <!-- Sentencing -->
                        <div class="charge-detail-header" style="margin-top:0;border-top:1px solid var(--gray-100);">Sentencing</div>
                        <div class="sentencing-table-wrap" style="padding:0 12px 10px;">
                          <table class="sentencing-table">
                            <thead><tr><th>Type</th><th>Date</th><th>Active</th><th>Suspended</th><th>Completed</th></tr></thead>
                            <tbody>
                              <tr>
                                <td><span class="cd-val">Fine</span></td>
                                <td><span class="cd-val">02/23/2014</span></td>
                                <td><span class="cd-val">$10,000</span></td>
                                <td>0</td>
                                <td><span class="cd-val">$1,000</span></td>
                              </tr>
                            </tbody>
                          </table>
                          <div class="sentencing-comment">Comments: <span>This is test data</span></div>
                        </div>
                      </div>
                      <!-- end charge detail -->
                    </div>
                  </div>
                  <!-- end case 101010 -->

                  <!-- Case 202020 -->
                  <div class="case-block" id="case-202020">
                    <div class="case-header" onclick="toggleCase('case-202020')">
                      <span style="font-size:9px;color:var(--gray-400);margin-right:2px;">▶</span>
                      <span class="case-num">Case #202020</span>
                      <span class="case-meta">Court House &nbsp;·&nbsp; Hays County, TX</span>
                      <span style="font-size:11px;color:var(--gray-400);margin-left:8px;">06/10/2016</span>
                      <div class="case-show-chk" onclick="event.stopPropagation()">
                        <input type="checkbox" checked id="show-202020"> Show these results?
                      </div>
                      <button class="edit-field-btn" onclick="event.stopPropagation();openEditModal('case-202020','Theft of Property — Case #202020')">✎ Edit</button>
                    </div>
                    <div class="case-detail">
                      <div class="defendant-row">
                        <div class="mugshot-placeholder">No<br>Photo</div>
                        <div class="defendant-fields">
                          <div class="def-field"><span class="def-label">Defendant:</span><span class="def-val">Johnny B Bad</span></div>
                          <div class="def-field"><span class="def-label">SSN:</span><span class="def-val">123-45-6789</span></div>
                          <div class="def-field"><span class="def-label">Gender:</span><span class="def-val">M</span></div>
                          <div class="def-field"><span class="def-label">DOB:</span><span class="def-val">02/23/1958</span></div>
                          <div class="def-field"><span class="def-label">Race:</span><span class="def-val">W</span></div>
                          <div class="def-field"><span class="def-label">Height:</span><span class="def-val">70 inches</span></div>
                        </div>
                      </div>
                      <div class="identifiers-row">
                        <strong>Identified By:</strong>
                        <label><input type="checkbox" checked> name</label>
                        <label><input type="checkbox" checked> date of birth</label>
                        <label><input type="checkbox"> social security number</label>
                        <label><input type="checkbox"> partial social security number</label>
                      </div>
                      <div class="case-info-grid">
                        <div class="ci-field"><span class="ci-label">Case Number:</span><span class="ci-val">202020</span></div>
                        <div class="ci-field"><span class="ci-label">Source:</span><span class="ci-val">Court House</span></div>
                        <div class="ci-field"><span class="ci-label">Source State:</span><span class="ci-val">TX</span></div>
                        <div class="ci-field"><span class="ci-label">Jurisdiction:</span><span class="ci-val">Hays County</span></div>
                        <div class="ci-field"><span class="ci-label">Offense Date:</span><span class="ci-val">06/10/2016</span></div>
                        <div class="ci-field"><span class="ci-label">Filing Date:</span><span class="ci-val">06/15/2016</span></div>
                        <div class="ci-field"><span class="ci-label">Disposition Date:</span><span class="ci-val">01/12/2017</span></div>
                      </div>
                      <div class="case-comments">Case comments: <span>—</span></div>
                      <div class="charge-detail-section">
                        <div class="charge-detail-header">
                          Charge #1
                          <button class="edit-field-btn" onclick="openEditModal('charge-202020-1','Charge #1 — Theft of Property')">✎ Edit</button>
                        </div>
                        <div class="charge-detail-grid">
                          <div class="cd-field"><span class="cd-label">Charge:</span><span class="cd-val">Theft of Property</span></div>
                          <div class="cd-field"><span class="cd-label">Crime Type:</span><span class="cd-val">Misdemeanor</span></div>
                          <div class="cd-field"><span class="cd-label">Disposition:</span><span class="cd-val">Dismissed</span></div>
                          <div class="cd-field"><span class="cd-label">Statute:</span><span class="cd-val">TX-31.03</span></div>
                          <div class="cd-field"><span class="cd-label">Plea:</span><span class="cd-val">Not guilty</span></div>
                          <div class="cd-field"><span class="cd-label">Offense Date:</span><span class="cd-val">June 10, 2016</span></div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- end case 202020 -->

                </div>
              </div>
              <!-- end charge #1 -->

              <!-- ── CHARGE #2: Drug Possession ── -->
              <div class="charge-block" id="charge-2">
                <div class="charge-header" onclick="toggleCharge('charge-2')">
                  <span class="charge-chevron">▶</span>
                  <span class="charge-title">Drug Possession</span>
                  <span class="tag felony" style="margin-left:6px;">Felony</span>
                  <span style="font-size:11px;color:var(--gray-400);margin-left:10px;">1 case</span>
                  <div style="margin-left:auto;display:flex;gap:6px;align-items:center;">
                    <span class="status-pill pending" style="font-size:11px;"><span class="dot"></span>Pending</span>
                    <select class="action-select" onclick="event.stopPropagation()" onchange="showToast('Action saved.')">
                      <option value="">Set Action...</option>
                      <option>Re-Verify</option>
                      <option>Accept Record</option>
                      <option>Dispute Record</option>
                      <option>Mark Reviewed</option>
                    </select>
                  </div>
                </div>
                <div class="charge-body">
                  <div class="case-block" id="case-445522">
                    <div class="case-header" onclick="toggleCase('case-445522')">
                      <span style="font-size:9px;color:var(--gray-400);margin-right:2px;">▶</span>
                      <span class="case-num">Case #445522</span>
                      <span class="case-meta">Travis County Court &nbsp;·&nbsp; Travis County, TX</span>
                      <span style="font-size:11px;color:var(--gray-400);margin-left:8px;">07/11/2016</span>
                      <div class="case-show-chk" onclick="event.stopPropagation()">
                        <input type="checkbox" checked id="show-445522"> Show these results?
                      </div>
                      <button class="edit-field-btn" onclick="event.stopPropagation();openEditModal('case-445522','Drug Possession — Case #445522')">✎ Edit</button>
                    </div>
                    <div class="case-detail">
                      <div class="defendant-row">
                        <div class="mugshot-placeholder">No<br>Photo</div>
                        <div class="defendant-fields">
                          <div class="def-field"><span class="def-label">Defendant:</span><span class="def-val">Johnny B Bad</span></div>
                          <div class="def-field"><span class="def-label">DOB:</span><span class="def-val">02/23/1958</span></div>
                          <div class="def-field"><span class="def-label">Gender:</span><span class="def-val">M</span></div>
                        </div>
                      </div>
                      <div class="identifiers-row">
                        <strong>Identified By:</strong>
                        <label><input type="checkbox" checked> name</label>
                        <label><input type="checkbox" checked> date of birth</label>
                        <label><input type="checkbox"> social security number</label>
                        <label><input type="checkbox"> partial social security number</label>
                      </div>
                      <div class="case-info-grid">
                        <div class="ci-field"><span class="ci-label">Case Number:</span><span class="ci-val">445522</span></div>
                        <div class="ci-field"><span class="ci-label">Jurisdiction:</span><span class="ci-val">Travis County</span></div>
                        <div class="ci-field"><span class="ci-label">Offense Date:</span><span class="ci-val">07/11/2016</span></div>
                        <div class="ci-field"><span class="ci-label">Filing Date:</span><span class="ci-val">07/09/2016</span></div>
                        <div class="ci-field"><span class="ci-label">Disposition Date:</span><span class="ci-val">—</span></div>
                      </div>
                      <div class="charge-detail-section">
                        <div class="charge-detail-header">
                          Charge #1
                          <button class="edit-field-btn" onclick="openEditModal('charge-445522-1','Charge #1 — Drug Possession')">✎ Edit</button>
                        </div>
                        <div class="charge-detail-grid">
                          <div class="cd-field"><span class="cd-label">Charge:</span><span class="cd-val">Drug Possession</span></div>
                          <div class="cd-field"><span class="cd-label">Crime Type:</span><span class="cd-val">Felony</span></div>
                          <div class="cd-field"><span class="cd-label">Disposition:</span><span class="cd-val">Pending</span></div>
                          <div class="cd-field"><span class="cd-label">Offense Date:</span><span class="cd-val">July 11, 2016</span></div>
                          <div class="cd-field"><span class="cd-label">Filing Date:</span><span class="cd-val">July 09, 2016</span></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- end charge #2 -->

              <!-- ── CHARGE #3: Disorderly Conduct ── -->
              <div class="charge-block" id="charge-3">
                <div class="charge-header" onclick="toggleCharge('charge-3')">
                  <span class="charge-chevron">▶</span>
                  <span class="charge-title">Disorderly Conduct</span>
                  <span class="tag infraction" style="margin-left:6px;">Infraction</span>
                  <span style="font-size:11px;color:var(--gray-400);margin-left:10px;">1 case</span>
                  <div style="margin-left:auto;display:flex;gap:6px;align-items:center;">
                    <span class="status-pill clear" style="font-size:11px;"><span class="dot"></span>Dismissed</span>
                    <select class="action-select" onclick="event.stopPropagation()" onchange="showToast('Action saved.')">
                      <option value="">Set Action...</option>
                      <option>Re-Verify</option>
                      <option>Accept Record</option>
                      <option>Dispute Record</option>
                      <option>Mark Reviewed</option>
                    </select>
                  </div>
                </div>
                <div class="charge-body">
                  <div class="case-block" id="case-998811">
                    <div class="case-header" onclick="toggleCase('case-998811')">
                      <span style="font-size:9px;color:var(--gray-400);margin-right:2px;">▶</span>
                      <span class="case-num">Case #998811</span>
                      <span class="case-meta">Hays County Court &nbsp;·&nbsp; Hays County, TX</span>
                      <span style="font-size:11px;color:var(--gray-400);margin-left:8px;">11/30/2019</span>
                      <div class="case-show-chk" onclick="event.stopPropagation()">
                        <input type="checkbox" checked id="show-998811"> Show these results?
                      </div>
                      <button class="edit-field-btn" onclick="event.stopPropagation();openEditModal('case-998811','Disorderly Conduct — Case #998811')">✎ Edit</button>
                    </div>
                    <div class="case-detail">
                      <div class="defendant-row">
                        <div class="mugshot-placeholder">No<br>Photo</div>
                        <div class="defendant-fields">
                          <div class="def-field"><span class="def-label">Defendant:</span><span class="def-val">Johnny B Bad</span></div>
                          <div class="def-field"><span class="def-label">DOB:</span><span class="def-val">02/23/1958</span></div>
                          <div class="def-field"><span class="def-label">Gender:</span><span class="def-val">M</span></div>
                        </div>
                      </div>
                      <div class="identifiers-row">
                        <strong>Identified By:</strong>
                        <label><input type="checkbox" checked> name</label>
                        <label><input type="checkbox" checked> date of birth</label>
                        <label><input type="checkbox"> social security number</label>
                        <label><input type="checkbox"> partial social security number</label>
                      </div>
                      <div class="case-info-grid">
                        <div class="ci-field"><span class="ci-label">Case Number:</span><span class="ci-val">998811</span></div>
                        <div class="ci-field"><span class="ci-label">Jurisdiction:</span><span class="ci-val">Hays County</span></div>
                        <div class="ci-field"><span class="ci-label">Offense Date:</span><span class="ci-val">11/30/2019</span></div>
                        <div class="ci-field"><span class="ci-label">Filing Date:</span><span class="ci-val">11/28/2019</span></div>
                        <div class="ci-field"><span class="ci-label">Disposition Date:</span><span class="ci-val">01/15/2020</span></div>
                      </div>
                      <div class="charge-detail-section">
                        <div class="charge-detail-header">
                          Charge #1
                          <button class="edit-field-btn" onclick="openEditModal('charge-998811-1','Charge #1 — Disorderly Conduct')">✎ Edit</button>
                        </div>
                        <div class="charge-detail-grid">
                          <div class="cd-field"><span class="cd-label">Charge:</span><span class="cd-val">Disorderly Conduct</span></div>
                          <div class="cd-field"><span class="cd-label">Crime Type:</span><span class="cd-val">Infraction</span></div>
                          <div class="cd-field"><span class="cd-label">Disposition:</span><span class="cd-val">Dismissed</span></div>
                          <div class="cd-field"><span class="cd-label">Offense Date:</span><span class="cd-val">November 30, 2019</span></div>
                          <div class="cd-field"><span class="cd-label">Filing Date:</span><span class="cd-val">November 28, 2019</span></div>
                          <div class="cd-field"><span class="cd-label">Disposition Date:</span><span class="cd-val">January 15, 2020</span></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- end charge #3 -->

            </div>
          </div>

          <!-- Tab: Subject Detail -->
          <div id="tab-subject-detail" style="display:none;">
            <div class="card">
              <div class="card-header"><div class="card-header-title">▸ Subject / Identifiers</div></div>
              <div class="card-body">
                <div class="subject-grid">
                  <div class="subject-field"><label>Name</label><div class="val">John Bad</div></div>
                  <div class="subject-field"><label>Address</label><div class="val">225 Smooth Street, Dripping Springs TX 78620</div></div>
                  <div class="subject-field"><label>DOB</label><div class="val">01/01/1980 (44)</div></div>
                  <div class="subject-field"><label>Height</label><div class="val">5'09"</div></div>
                  <div class="subject-field"><label>Weight</label><div class="val">175 pounds</div></div>
                  <div class="subject-field"><label>Eye Color</label><div class="val">Hazel</div></div>
                  <div class="subject-field"><label>Hair Color</label><div class="val">Red</div></div>
                  <div class="subject-field"><label>Race</label><div class="val">—</div></div>
                  <div class="subject-field"><label>OLN #</label><div class="val">123-456-789</div></div>
                  <div class="subject-field"><label>State</label><div class="val">TX</div></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Tab: Case Notes -->
          <div id="tab-case-notes" style="display:none;">
            <div class="card">
              <div class="card-header"><div class="card-header-title">▸ Case Notes</div></div>
              <div class="card-body">
                <div class="form-field">
                  <label>Add Note</label>
                  <textarea class="notes-area" placeholder="Enter note..."></textarea>
                </div>
                <button onclick="showToast('Note saved.')" style="padding:6px 14px;background:var(--primary);color:#fff;border:none;border-radius:6px;font-size:12px;font-weight:600;cursor:pointer;font-family:var(--font);">Add Note</button>
                <div style="margin-top:16px;border-top:1px solid var(--gray-100);padding-top:12px;">
                  <div style="font-size:11px;color:var(--gray-400);margin-bottom:8px;font-weight:600;text-transform:uppercase;letter-spacing:.06em;">Previous Notes</div>
                  <div style="font-size:12px;color:var(--gray-500);font-style:italic;">No notes recorded yet.</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions Panel -->
        <div class="actions-panel">
          <div class="actions-panel-header">
            <div class="actions-panel-title">Actions</div>
            <button class="configure-btn" onclick="openConfigDrawer()"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="2"/><path d="M8 1v2M8 13v2M1 8h2M13 8h2M3.05 3.05l1.41 1.41M11.54 11.54l1.41 1.41M3.05 12.95l1.41-1.41M11.54 4.46l1.41-1.41"/></svg> Configure</button>
          </div>

          <div class="actions-panel-section">
            <div class="actions-section-title">Order Options</div>
            <a class="action-link" data-aid="order-additional" id="alink-order-additional">Order Additional Search</a>
            <a class="action-link" data-aid="order-statewide" id="alink-order-statewide">Order Statewide Search</a>
            <a class="action-link" data-aid="order-court" id="alink-order-court">Contact Court Directly</a>
            <a class="action-link" data-aid="order-preadverse" id="alink-order-preadverse">Pre-Adverse Notice</a>
          </div>
          <div class="actions-panel-section">
            <div class="actions-section-title">Case Notes</div>
            <textarea class="notes-area" placeholder="Add a note..." style="width:100%;font-size:12px;padding:7px;border:1.5px solid var(--gray-200);border-radius:6px;font-family:var(--font);resize:vertical;min-height:70px;"></textarea>
            <a class="action-link" onclick="showToast('Note saved.')">Save Note</a>
          </div>
        </div>
      </div>
    </div>
    </div>

    <!-- ══ EMPLOYMENT PANEL ══ -->
    <div class="panel" id="panel-employment">
      <div class="breadcrumb">
        <span class="crumb" onclick="showPanel('overview', document.getElementById('sidebar-overview'))">Report Summary</span>
        <span class="sep">›</span>
        <span class="crumb active">Employment Verification</span>
      </div>
      <div class="panel-header">
        <div class="panel-title-group">
          <div class="panel-title">Employment Verification</div>
          <div class="panel-subtitle">UT of Austin &nbsp;·&nbsp; Austin, TX</div>
        </div>
        <div class="panel-actions">
          <button class="view-history-btn" onclick="openHistory('employment')"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><path d="M8 5v3.5l2 1.5"/></svg> View History</button>
          <button class="header-btn" onclick="showToast('Draft saved.')">Save Draft</button>
        </div>
      </div>

      <!-- Fill Status Bar -->
      <div class="fill-status-bar" id="fsbar-employment">
        <div class="fsb-col">
          <div class="fsb-col-label">Order #</div>
          <div class="fsb-col-val">E-04813</div>
        </div>
        <div class="fsb-col">
          <div class="fsb-col-label">Jurisdiction</div>
          <div class="fsb-col-val">Austin, TX</div>
        </div>
        <div class="fsb-col">
          <div class="fsb-col-label">Employer</div>
          <div class="fsb-col-val">UT of Austin</div>
        </div>
        <div class="fsb-col">
          <div class="fsb-col-label">Search Type</div>
          <div class="fsb-col-val">Employment Verif.</div>
        </div>
        <div class="fsb-col fsb-status-col">
          <div class="fsb-col-label"><span class="fsb-required"></span>Fill Status</div>
          <select class="fsb-select status-inprogress" id="fillStatus-employment" onchange="onFillStatusChange('employment', this)">
            <option value="in progress" selected>In Progress</option>
            <option value="complete" >Complete</option>
          </select>
        </div>
        <div class="fsb-col fsb-status-col">
          <div class="fsb-col-label"><span class="fsb-required"></span>Filled Code</div>
          <select class="fsb-select code-unknown" id="filledCode-employment" onchange="onFilledCodeChange('employment', this)">
            <option value="unknown" selected>Unknown</option>
            <option value="verified – matches" >Verified – Matches</option>
            <option value="verified – discrepancy" >Verified – Discrepancy</option>
            <option value="unable to verify" >Unable to Verify</option>
          </select>
        </div>
        <div class="fsb-save-col">
          <button class="fsb-save-btn" onclick="saveStatus('employment')">Save</button>
          <span class="fsb-saved-indicator" id="fsbSaved-employment">✓ Saved</span>
        </div>
      </div>
      <div class="content-with-actions">
        <div>

<div class="requester-bar collapsed" id="requester-bar-employment">
            <div class="requester-bar-header" onclick="this.closest('.requester-bar').classList.toggle('collapsed')">
              <span class="requester-bar-chevron">▼</span>
              <span class="requester-bar-title">Requester</span>
            </div>
            <div class="requester-bar-body">
              <div class="req-field">
                <div class="req-label">Account</div>
                <div class="req-val">hcrally/admin</div>
              </div>
              <div class="req-field">
                <div class="req-label">Organization</div>
                <div class="req-val">Hill Country Rally for Kids</div>
              </div>
              <div class="req-field">
                <div class="req-label">Name</div>
                <div class="req-val">Hank Jones</div>
              </div>
              <div class="req-field">
                <div class="req-label">Email</div>
                <div class="req-val">codymoch@gmail.com</div>
              </div>
              <div class="req-field">
                <div class="req-label">Phone</div>
                <div class="req-val">444-999-9999</div>
              </div>
              <div class="req-field">
                <div class="req-label">Fax</div>
                <div class="req-val">—</div>
              </div>
            </div>
          </div>
          <div class="card gap-analysis-card collapsed" id="gap-employment">
            <div class="card-header" onclick="toggleGap('employment')">
              <div class="card-header-title">▸ Gap Analysis</div>
              <div class="card-header-spacer"></div>
              <span style="font-size:11px;color:var(--gray-400);">Tolerance: 60 days &nbsp;·&nbsp; 7 years</span>
              <span class="gap-collapse-chevron">▼</span>
            </div>
            <div class="gap-collapse-body">
            <div style="overflow-x:auto;">
              <table class="gap-table">
                <thead>
                  <tr>
                    <th>Order #</th>
                    <th>From Date</th>
                    <th>To Date</th>
                    <th>Element Type</th>
                    <th>Element Description</th>
                    <th style="text-align:right;">Gap Days</th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="gap-within">
              <td><a class="gap-order-link">235</a>/<a class="gap-order-link">0</a></td>
              <td><div class="gap-date-cell"><span class="gap-dot verified"></span>02/01/2021</div></td>
              <td><div class="gap-date-cell"><span class="gap-dot verified"></span>02/01/2021</div></td>
              <td>Research End Date</td>
              <td>Research End Date</td>
              <td style="text-align:right;"><span class="gap-days within">0</span></td>
            </tr>
<tr class="gap-outside">
              <td><a class="gap-order-link">235</a>/<a class="gap-order-link">0</a></td>
              <td><div class="gap-date-cell"><span class="gap-dot verified"></span>02/01/2014</div></td>
              <td><div class="gap-date-cell"><span class="gap-dot verified"></span>02/01/2014</div></td>
              <td>Research Start Date</td>
              <td>Research Start Date</td>
              <td style="text-align:right;"><span class="gap-days outside">2556</span></td>
            </tr>
<tr class="gap-missing">
              <td><a class="gap-order-link">235</a>/<a class="gap-order-link">600618</a></td>
              <td><span style="color:var(--gray-300)">—</span></td>
              <td><span style="color:var(--gray-300)">—</span></td>
              <td>Employment_verification</td>
              <td>UT OF AUSTIN</td>
              <td style="text-align:right;"><span class="gap-days none">—</span></td>
            </tr>

                </tbody>
              </table>
            </div>
            <div class="gap-legend">
              <div class="gap-legend-row">
                <div class="gap-legend-item"><span class="gap-legend-swatch within"></span> Within tolerance</div>
                <div class="gap-legend-item"><span class="gap-legend-swatch outside"></span> Outside tolerance</div>
                <div class="gap-legend-item"><span class="gap-legend-swatch negative"></span> Negative timespan</div>
                <span class="gap-tolerance-note">
                  <span class="gap-dot verified"></span> verified &nbsp;
                  <span class="gap-dot unverified"></span> unverified
                </span>
              </div>
            </div>
            </div>
          </div>

          <!-- Two-column verification form -->
          <div class="card">
            <div class="card-header">
              <div class="card-header-title">▸ Employment Verification Form</div>
              <div class="card-header-spacer"></div>
            </div>
            <div class="verif-form">
              <div class="verif-header-row">
                <div class="vh-label">From Applicant</div>
                <div></div>
                <div class="vh-label">Verified / Confirmed</div>
              </div>
              
          <div class="verif-row">
            <div class="verif-applicant">
              <div class="verif-field-label">Employer Name</div>
              <div class="verif-applicant-val" id="av-emp-name">UT OF AUSTIN</div>
            </div>
            <button class="verif-copy-btn" id="cb-emp-name" onclick="copyField('emp-name')" title="Copy to verified"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 8h10M9 4l4 4-4 4"/></svg></button>
            <div class="verif-confirmed">
              <div class="verif-field-label">&nbsp;</div>
              <div class="verif-confirmed-inner">
                <input type="text" id="vi-emp-name" placeholder="Enter verified name..." oninput="checkMatch('emp-name')" />
                <div class="match-indicator match-unknown" id="mi-emp-name">?</div>
              </div>
            </div>
          </div>
          <div class="verif-row">
            <div class="verif-applicant">
              <div class="verif-field-label">Job Title / Position</div>
              <div class="verif-applicant-val" id="av-emp-title">Research Analyst</div>
            </div>
            <button class="verif-copy-btn" id="cb-emp-title" onclick="copyField('emp-title')" title="Copy to verified"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 8h10M9 4l4 4-4 4"/></svg></button>
            <div class="verif-confirmed">
              <div class="verif-field-label">&nbsp;</div>
              <div class="verif-confirmed-inner">
                <input type="text" id="vi-emp-title" placeholder="Enter verified title..." oninput="checkMatch('emp-title')" />
                <div class="match-indicator match-unknown" id="mi-emp-title">?</div>
              </div>
            </div>
          </div>
          <div class="verif-row">
            <div class="verif-applicant">
              <div class="verif-field-label">Dates Employed (From)</div>
              <div class="verif-applicant-val" id="av-emp-from">06/2015</div>
            </div>
            <button class="verif-copy-btn" id="cb-emp-from" onclick="copyField('emp-from')" title="Copy to verified"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 8h10M9 4l4 4-4 4"/></svg></button>
            <div class="verif-confirmed">
              <div class="verif-field-label">&nbsp;</div>
              <div class="verif-confirmed-inner">
                <input type="text" id="vi-emp-from" placeholder="MM/YYYY" oninput="checkMatch('emp-from')" />
                <div class="match-indicator match-unknown" id="mi-emp-from">?</div>
              </div>
            </div>
          </div>
          <div class="verif-row">
            <div class="verif-applicant">
              <div class="verif-field-label">Dates Employed (To)</div>
              <div class="verif-applicant-val" id="av-emp-to">Present</div>
            </div>
            <button class="verif-copy-btn" id="cb-emp-to" onclick="copyField('emp-to')" title="Copy to verified"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 8h10M9 4l4 4-4 4"/></svg></button>
            <div class="verif-confirmed">
              <div class="verif-field-label">&nbsp;</div>
              <div class="verif-confirmed-inner">
                <input type="text" id="vi-emp-to" placeholder="MM/YYYY or Present" oninput="checkMatch('emp-to')" />
                <div class="match-indicator match-unknown" id="mi-emp-to">?</div>
              </div>
            </div>
          </div>
          <div class="verif-row">
            <div class="verif-applicant">
              <div class="verif-field-label">Supervisor Name</div>
              <div class="verif-applicant-val" id="av-emp-super">Dr. Sarah Lee</div>
            </div>
            <button class="verif-copy-btn" id="cb-emp-super" onclick="copyField('emp-super')" title="Copy to verified"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 8h10M9 4l4 4-4 4"/></svg></button>
            <div class="verif-confirmed">
              <div class="verif-field-label">&nbsp;</div>
              <div class="verif-confirmed-inner">
                <input type="text" id="vi-emp-super" placeholder="Enter verified name..." oninput="checkMatch('emp-super')" />
                <div class="match-indicator match-unknown" id="mi-emp-super">?</div>
              </div>
            </div>
          </div>
          <div class="verif-row">
            <div class="verif-applicant">
              <div class="verif-field-label">Salary / Rate</div>
              <div class="verif-applicant-val" id="av-emp-salary">$68,000/yr</div>
            </div>
            <button class="verif-copy-btn" id="cb-emp-salary" onclick="copyField('emp-salary')" title="Copy to verified"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 8h10M9 4l4 4-4 4"/></svg></button>
            <div class="verif-confirmed">
              <div class="verif-field-label">&nbsp;</div>
              <div class="verif-confirmed-inner">
                <input type="text" id="vi-emp-salary" placeholder="Enter verified salary..." oninput="checkMatch('emp-salary')" />
                <div class="match-indicator match-unknown" id="mi-emp-salary">?</div>
              </div>
            </div>
          </div>
          <div class="verif-row">
            <div class="verif-applicant">
              <div class="verif-field-label">Reason for Leaving</div>
              <div class="verif-applicant-val" id="av-emp-reason">Still employed</div>
            </div>
            <button class="verif-copy-btn" id="cb-emp-reason" onclick="copyField('emp-reason')" title="Copy to verified"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 8h10M9 4l4 4-4 4"/></svg></button>
            <div class="verif-confirmed">
              <div class="verif-field-label">&nbsp;</div>
              <div class="verif-confirmed-inner">
                <input type="text" id="vi-emp-reason" placeholder="Enter reason..." oninput="checkMatch('emp-reason')" />
                <div class="match-indicator match-unknown" id="mi-emp-reason">?</div>
              </div>
            </div>
          </div>
          <div class="verif-row">
            <div class="verif-applicant">
              <div class="verif-field-label">Eligible for Rehire</div>
              <div class="verif-applicant-val" id="av-emp-rehire">Yes</div>
            </div>
            <button class="verif-copy-btn" id="cb-emp-rehire" onclick="copyField('emp-rehire')" title="Copy to verified"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 8h10M9 4l4 4-4 4"/></svg></button>
            <div class="verif-confirmed">
              <div class="verif-field-label">&nbsp;</div>
              <div class="verif-confirmed-inner">
                <select id="vi-emp-rehire" onchange="checkMatch('emp-rehire')">
                <option value="">Select...</option>
                <option>Yes</option><option>No</option><option>Unknown</option>
              </select>
                <div class="match-indicator match-unknown" id="mi-emp-rehire">?</div>
              </div>
            </div>
          </div>
              <div class="verif-form-footer">
                <button class="copy-all-btn" onclick="copyAllFields('emp')" title="Copy all applicant values to verified">
                  <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 8h10M9 4l4 4-4 4"/></svg> Copy All to Verified
                </button>
                <span style="font-size:11px;color:var(--gray-400);margin-left:4px;">Click → to copy individual fields</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions Panel -->
        <div class="actions-panel">
          <div class="actions-panel-header">
            <div class="actions-panel-title">Actions</div>
            <button class="configure-btn" onclick="openConfigDrawer()"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="2"/><path d="M8 1v2M8 13v2M1 8h2M13 8h2M3.05 3.05l1.41 1.41M11.54 11.54l1.41 1.41M3.05 12.95l1.41-1.41M11.54 4.46l1.41-1.41"/></svg> Configure</button>
          </div>
          <div class="actions-panel-section">
            <div class="actions-section-title">Gap Information</div>
            <textarea class="notes-area" placeholder="Document any employment/education gaps..." style="width:100%;font-size:12px;padding:7px;border:1.5px solid var(--gray-200);border-radius:6px;font-family:var(--font);resize:vertical;min-height:64px;"></textarea>
            <a class="action-link" onclick="showToast('Gap info saved.')">Save</a>
          </div>
          <div class="actions-panel-section">
            <div class="actions-section-title">Next Action</div>
            <select class="disposition-select" onchange="showToast('Next action set.')">
              <option value="">Select next action...</option>
              <option>Follow Up Call</option>
              <option>Send Fax</option>
              <option>Await Response</option>
              <option>Escalate</option>
              <option>Close Out</option>
            </select>
          </div>
          <div class="actions-panel-section">
            <div class="actions-section-title">ETA Status</div>
            <select class="disposition-select" onchange="showToast('ETA updated.')">
              <option value="">Select ETA...</option>
              <option>Today</option>
              <option>1–2 Business Days</option>
              <option>3–5 Business Days</option>
              <option>1–2 Weeks</option>
              <option>Awaiting Applicant</option>
              <option>Unknown</option>
            </select>
          </div>
          <div class="actions-panel-section">
            <div class="actions-section-title">Requests</div>
            <a class="action-link" onclick="showToast('Signed release request sent.')">Request a Signed Release</a>
            <a class="action-link" onclick="showToast('Document upload request sent to applicant.')">Request Document Upload from Applicant</a>
          </div>
          <div class="actions-panel-section">
            <div class="actions-section-title">Attachments</div>
            <label class="action-upload-btn" title="Attach a picture">
              <input type="file" accept="image/*" style="display:none;" onchange="showToast('Image attached: ' + this.files[0]?.name)">
              📷 Attach a Picture
            </label>
            <label class="action-upload-btn" title="Attach a PDF">
              <input type="file" accept=".pdf" style="display:none;" onchange="showToast('PDF attached: ' + this.files[0]?.name)">
              📄 Attach a PDF
            </label>
          </div>
      </div>
    </div>
    </div>

    <!-- ══ MVR PANEL ══ -->
    <div class="panel" id="panel-mvr">
      <div class="breadcrumb">
        <span class="crumb" onclick="showPanel('overview', document.getElementById('sidebar-overview'))">Report Summary</span>
        <span class="sep">›</span>
        <span class="crumb active">MVR</span>
      </div>
      <div class="panel-header">
        <div class="panel-title-group">
          <div class="panel-title">Motor Vehicle Record</div>
          <div class="panel-subtitle">Texas DPS &nbsp;·&nbsp; State of Texas</div>
        </div>
        <div class="panel-actions">
          <button class="view-history-btn" onclick="openHistory('mvr')"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><path d="M8 5v3.5l2 1.5"/></svg> View History</button>
          <button class="header-btn" onclick="showToast('MVR report saved.')">Save</button>
        </div>
      </div>

      <!-- Fill Status Bar -->
      <div class="fill-status-bar" id="fsbar-mvr">
        <div class="fsb-col">
          <div class="fsb-col-label">Order #</div>
          <div class="fsb-col-val">M-04814</div>
        </div>
        <div class="fsb-col">
          <div class="fsb-col-label">Jurisdiction</div>
          <div class="fsb-col-val">Texas DPS</div>
        </div>
        <div class="fsb-col">
          <div class="fsb-col-label">License #</div>
          <div class="fsb-col-val">TX-12345678</div>
        </div>
        <div class="fsb-col">
          <div class="fsb-col-label">Search Type</div>
          <div class="fsb-col-val">Motor Vehicle Record</div>
        </div>
        <div class="fsb-col fsb-status-col">
          <div class="fsb-col-label"><span class="fsb-required"></span>Fill Status</div>
          <select class="fsb-select status-inprogress" id="fillStatus-mvr" onchange="onFillStatusChange('mvr', this)">
            <option value="in progress" selected>In Progress</option>
            <option value="complete" >Complete</option>
          </select>
        </div>
        <div class="fsb-col fsb-status-col">
          <div class="fsb-col-label"><span class="fsb-required"></span>Filled Code</div>
          <select class="fsb-select code-unknown" id="filledCode-mvr" onchange="onFilledCodeChange('mvr', this)">
            <option value="unknown" selected>Unknown</option>
            <option value="clear" >Clear</option>
            <option value="violations found" >Violations Found</option>
            <option value="suspended" >Suspended</option>
            <option value="revoked" >Revoked</option>
          </select>
        </div>
        <div class="fsb-save-col">
          <button class="fsb-save-btn" onclick="saveStatus('mvr')">Save</button>
          <span class="fsb-saved-indicator" id="fsbSaved-mvr">✓ Saved</span>
        </div>
      </div>
      <div class="content-with-actions">
        <div>
          <div class="card" style="margin-bottom:16px;">
            <div class="card-header"><div class="card-header-title">▸ Driver Information</div></div>
            <div class="card-body">
              <div class="subject-grid">
                <div class="subject-field"><label>Name</label><div class="val">JOHN V. BAD</div></div>
                <div class="subject-field"><label>DOB</label><div class="val">01/01/1980</div></div>
                <div class="subject-field"><label>Address</label><div class="val">225 Smooth St, Dripping Springs TX</div></div>
                <div class="subject-field"><label>License #</label><div class="val">TX-12345678</div></div>
                <div class="subject-field"><label>Class</label><div class="val">Class C</div></div>
                <div class="subject-field"><label>Restrictions</label><div class="val">None</div></div>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-header-title">▸ Violations / Convictions</div>
              <div class="card-header-spacer"></div>
              <span style="font-size:11px;color:var(--danger);font-weight:600;">2 violations found</span>
            </div>
            <div class="card-body" style="padding:0;overflow-x:auto;">
              <table class="mvr-violations">
                <thead>
                  <tr>
                    <th>Violation</th>
                    <th>Date</th>
                    <th>Conviction Date</th>
                    <th>Points</th>
                    <th>Fine</th>
                    <th>State</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><strong>Speeding — 20+ Over Limit</strong></td>
                    <td>04/12/2021</td>
                    <td>06/01/2021</td>
                    <td><span style="color:var(--danger);font-weight:600;">4</span></td>
                    <td>$350</td>
                    <td>TX</td>
                    <td>
                      <select class="action-select" onchange="showToast('Action saved.')">
                        <option value="">Set Action...</option>
                        <option>Accept</option>
                        <option>Dispute</option>
                        <option>Re-Verify</option>
                        <option>Flag for Review</option>
                      </select>
                    </td>
                  </tr>
                  <tr>
                    <td><strong>Failure to Stop at Red Light</strong></td>
                    <td>09/03/2022</td>
                    <td>10/15/2022</td>
                    <td><span style="color:var(--warning);font-weight:600;">2</span></td>
                    <td>$200</td>
                    <td>TX</td>
                    <td>
                      <select class="action-select" onchange="showToast('Action saved.')">
                        <option value="">Set Action...</option>
                        <option>Accept</option>
                        <option>Dispute</option>
                        <option>Re-Verify</option>
                        <option>Flag for Review</option>
                      </select>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="actions-panel">
          <div class="actions-panel-header">
            <div class="actions-panel-title">Actions</div>
            <button class="configure-btn" onclick="openConfigDrawer()"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="2"/><path d="M8 1v2M8 13v2M1 8h2M13 8h2M3.05 3.05l1.41 1.41M11.54 11.54l1.41 1.41M3.05 12.95l1.41-1.41M11.54 4.46l1.41-1.41"/></svg> Configure</button>
          </div>
          <div class="actions-panel-section">
            <div class="actions-section-title">Actions</div>
            <a class="action-link" data-aid="mvr-order" id="alink-mvr-order">Order New MVR</a>
            <a class="action-link" data-aid="mvr-dmv" id="alink-mvr-dmv">Contact DMV</a>
            <a class="action-link" data-aid="mvr-abstract" id="alink-mvr-abstract">Request Driving Abstract</a>
          </div>
        </div>
      </div>
    </div>

    <!-- ══ EDUCATION PANEL ══ -->
    <div class="panel" id="panel-education">
      <div class
="breadcrumb">
        <span class="crumb" onclick="showPanel('overview', document.getElementById('sidebar-overview'))">Report Summary</span>
        <span class="sep">›</span>
        <span class="crumb active">Education Verification</span>
      </div>
      <div class="panel-header">
        <div class="panel-title-group">
          <div class="panel-title">Education Verification</div>
          <div class="panel-subtitle">University of Texas at Austin &nbsp;·&nbsp; Austin, TX</div>
        </div>
        <div class="panel-actions">
          <button class="view-history-btn" onclick="openHistory('education')"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="6"/><path d="M8 5v3.5l2 1.5"/></svg> View History</button>
          <button class="header-btn" onclick="showToast('Draft saved.')">Save Draft</button>
        </div>
      </div>

      <!-- Fill Status Bar -->
      <div class="fill-status-bar" id="fsbar-education">
        <div class="fsb-col">
          <div class="fsb-col-label">Order #</div>
          <div class="fsb-col-val">ED-04815</div>
        </div>
        <div class="fsb-col">
          <div class="fsb-col-label">Jurisdiction</div>
          <div class="fsb-col-val">Austin, TX</div>
        </div>
        <div class="fsb-col">
          <div class="fsb-col-label">Institution</div>
          <div class="fsb-col-val">UT of Austin</div>
        </div>
        <div class="fsb-col">
          <div class="fsb-col-label">Search Type</div>
          <div class="fsb-col-val">Education Verif.</div>
        </div>
        <div class="fsb-col fsb-status-col">
          <div class="fsb-col-label"><span class="fsb-required"></span>Fill Status</div>
          <select class="fsb-select status-complete" id="fillStatus-education" onchange="onFillStatusChange('education', this)">
            <option value="in progress" >In Progress</option>
            <option value="complete" selected>Complete</option>
          </select>
        </div>
        <div class="fsb-col fsb-status-col">
          <div class="fsb-col-label"><span class="fsb-required"></span>Filled Code</div>
          <select class="fsb-select code-clear" id="filledCode-education" onchange="onFilledCodeChange('education', this)">
            <option value="unknown" >Unknown</option>
            <option value="clear" selected>Clear</option>
            <option value="discrepancy" >Discrepancy</option>
            <option value="unable to verify" >Unable to Verify</option>
          </select>
        </div>
        <div class="fsb-save-col">
          <button class="fsb-save-btn" onclick="saveStatus('education')">Save</button>
          <span class="fsb-saved-indicator" id="fsbSaved-education">✓ Saved</span>
        </div>
      </div>
      <div class="content-with-actions">
        <div>
          <div class="requester-bar collapsed" id="requester-bar-education">
            <div class="requester-bar-header" onclick="this.closest('.requester-bar').classList.toggle('collapsed')">
              <span class="requester-bar-chevron">▼</span>
              <span class="requester-bar-title">Requester</span>
            </div>
            <div class="requester-bar-body">
              <div class="req-field">
                <div class="req-label">Account</div>
                <div class="req-val">hcrally/admin</div>
              </div>
              <div class="req-field">
                <div class="req-label">Organization</div>
                <div class="req-val">Hill Country Rally for Kids</div>
              </div>
              <div class="req-field">
                <div class="req-label">Name</div>
                <div class="req-val">Hank Jones</div>
              </div>
              <div class="req-field">
                <div class="req-label">Email</div>
                <div class="req-val">codymoch@gmail.com</div>
              </div>
              <div class="req-field">
                <div class="req-label">Phone</div>
                <div class="req-val">444-999-9999</div>
              </div>
              <div class="req-field">
                <div class="req-label">Fax</div>
                <div class="req-val">—</div>
              </div>
            </div>
          </div>
          <div class="card gap-analysis-card collapsed" id="gap-education">
            <div class="card-header" onclick="toggleGap('education')">
              <div class="card-header-title">▸ Gap Analysis</div>
              <div class="card-header-spacer"></div>
              <span style="font-size:11px;color:var(--gray-400);">Tolerance: 60 days &nbsp;·&nbsp; 7 years</span>
              <span class="gap-collapse-chevron">▼</span>
            </div>
            <div class="gap-collapse-body">
            <div style="overflow-x:auto;">
              <table class="gap-table">
                <thead><tr>
                  <th>Order #</th><th>From Date</th><th>To Date</th>
                  <th>Element Type</th><th>Element Description</th>
                  <th style="text-align:right;">Gap Days</th>
                </tr></thead>
                <tbody><tr class="gap-within">
              <td><a class="gap-order-link">235</a>/<a class="gap-order-link">0</a></td>
              <td><div class="gap-date-cell"><span class="gap-dot verified"></span>02/01/2021</div></td>
              <td><div class="gap-date-cell"><span class="gap-dot verified"></span>02/01/2021</div></td>
              <td>Research End Date</td>
              <td>Research End Date</td>
              <td style="text-align:right;"><span class="gap-days within">0</span></td>
            </tr>
<tr class="gap-outside">
              <td><a class="gap-order-link">235</a>/<a class="gap-order-link">0</a></td>
              <td><div class="gap-date-cell"><span class="gap-dot verified"></span>02/01/2014</div></td>
              <td><div class="gap-date-cell"><span class="gap-dot verified"></span>02/01/2014</div></td>
              <td>Research Start Date</td>
              <td>Research Start Date</td>
              <td style="text-align:right;"><span class="gap-days outside">2556</span></td>
            </tr>
<tr class="gap-missing">
              <td><a class="gap-order-link">235</a>/<a class="gap-order-link">600618</a></td>
              <td><span style="color:var(--gray-300)">—</span></td>
              <td><span style="color:var(--gray-300)">—</span></td>
              <td>Education_verification</td>
              <td>UT OF AUSTIN</td>
              <td style="text-align:right;"><span class="gap-days none">—</span></td>
            </tr>
</tbody>
              </table>
            </div>
            <div class="gap-legend">
              <div class="gap-legend-row">
                <div class="gap-legend-item"><span class="gap-legend-swatch within"></span> Within tolerance</div>
                <div class="gap-legend-item"><span class="gap-legend-swatch outside"></span> Outside tolerance</div>
                <div class="gap-legend-item"><span class="gap-legend-swatch negative"></span> Negative timespan</div>
                <span class="gap-tolerance-note"><span class="gap-dot verified"></span> verified &nbsp;<span class="gap-dot unverified"></span> unverified</span>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-header"><div class="card-header-title">▸ Education Verification Form</div></div>
            <div class="verification-grid">
              <div class="verification-col">
                <div class="verification-col-header">From Applicant</div>
                <div class="form-field"><label>School Name</label><div class="applicant-val">UT OF AUSTIN</div></div>
                <div class="form-field"><label>School Address</label><div class="applicant-val">AUSTIN TX</div></div>
                <div class="form-field"><label>School Phone</label><div class="applicant-val">555-555-5555</div></div>
                <div class="form-field"><label>Degree</label><div class="applicant-val">Bachelor of Science</div></div>
                <div class="form-field"><label>Major</label><div class="applicant-val">Computer Science</div></div>
                <div class="form-field"><label>GPA</label><div class="applicant-val">3.7</div></div>
                <div class="form-field"><label>Attended From</label><div class="applicant-val">08/2000</div></div>
                <div class="form-field"><label>Attended To</label><div class="applicant-val">05/2004</div></div>
                <div class="form-field"><label>Graduated?</label><div class="applicant-val">Yes</div></div>
                <div class="form-field"><label>Student ID</label><div class="applicant-val">98765-43</div></div>
              </div>
              <div class="verification-col">
                <div class="verification-col-header">Verified / Confirmed</div>
                <div class="form-field">
                  <label>School Name</label>
                  <div class="field-row">
                    <input type="text" value="UT OF AUSTIN" />
                    <div class="match-indicator match-yes">✓</div>
                  </div>
                </div>
                <div class="form-field">
                  <label>School Address</label>
                  <div class="field-row">
                    <input type="text" value="AUSTIN TX" />
                    <div class="match-indicator match-yes">✓</div>
                  </div>
                </div>
                <div class="form-field">
                  <label>School Phone</label>
                  <div class="field-row">
                    <input type="text" value="555-555-5555" />
                    <div class="match-indicator match-yes">✓</div>
                  </div>
                </div>
                <div class="form-field">
                  <label>Degree</label>
                  <div class="field-row">
                    <input type="text" value="Bachelor of Science" />
                    <div class="match-indicator match-yes">✓</div>
                  </div>
                </div>
                <div class="form-field">
                  <label>Major</label>
                  <div class="field-row">
                    <input type="text" value="Computer Science" />
                    <div class="match-indicator match-yes">✓</div>
                  </div>
                </div>
                <div class="form-field">
                  <label>GPA</label>
                  <div class="field-row">
                    <input type="text" value="3.7" />
                    <div class="match-indicator match-yes">✓</div>
                  </div>
                </div>
                <div class="form-field">
                  <label>Attended From</label>
                  <div class="field-row">
                    <input type="text" value="08/2000" />
                    <div class="match-indicator match-yes">✓</div>
                  </div>
                </div>
                <div class="form-field">
                  <label>Attended To</label>
                  <div class="field-row">
                    <input type="text" value="05/2004" />
                    <div class="match-indicator match-yes">✓</div>
                  </div>
                </div>
                <div class="form-field">
                  <label>Graduated?</label>
                  <div class="field-row">
                    <select style="flex:1;"><option>Yes</option><option>No</option></select>
                    <div class="match-indicator match-yes">✓</div>
                  </div>
                </div>
                <div class="form-field">
                  <label>Transcripts?</label>
                  <div class="field-row">
                    <select style="flex:1;"><option>Yes</option><option>No</option></select>
                    <div class="match-indicator match-yes">✓</div>
                  </div>
                </div>
              </div>
            </div>
            <div style="padding:12px 16px;border-top:1px solid var(--gray-100);background:var(--gray-50);">
              <div class="form-field">
                <label>Verifier</label>
                <input type="text" placeholder="Verifier name..." style="max-width:300px;" />
              </div>
              <div class="form-field" style="margin-bottom:0;">
                <label>Verifier's Position</label>
                <input type="text" placeholder="Title..." style="max-width:300px;" />
              </div>
            </div>
            </div>
          </div>
        </div>

        <div class="actions-panel">
          <div class="actions-panel-header">
            <div class="actions-panel-title">Actions</div>
            <button class="configure-btn" onclick="openConfigDrawer()"><svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="8" cy="8" r="2"/><path d="M8 1v2M8 13v2M1 8h2M13 8h2M3.05 3.05l1.41 1.41M11.54 11.54l1.41 1.41M3.05 12.95l1.41-1.41M11.54 4.46l1.41-1.41"/></svg> Configure</button>
          </div>
          <div class="actions-panel-section">
            <div class="actions-section-title">Gap Information</div>
            <textarea class="notes-area" placeholder="Document any gaps..." style="width:100%;font-size:12px;padding:7px;border:1.5px solid var(--gray-200);border-radius:6px;font-family:var(--font);resize:vertical;min-height:64px;"></textarea>
            <a class="action-link" onclick="showToast('Gap info saved.')">Save</a>
          </div>
          <div class="actions-panel-section">
            <div class="actions-section-title">Next Action</div>
            <select class="disposition-select" onchange="showToast('Next action set.')">
              <option value="">Select next action...</option>
              <option>Follow Up Call</option>
              <option>Send Fax</option>
              <option>Await Response</option>
              <option>Escalate</option>
              <option>Close Out</option>
            </select>
          </div>
          <div class="actions-panel-section">
            <div class="actions-section-title">ETA Status</div>
            <select class="disposition-select" onchange="showToast('ETA updated.')">
              <option value="">Select ETA...</option>
              <option>Today</option>
              <option>1–2 Business Days</option>
              <option>3–5 Business Days</option>
              <option>1–2 Weeks</option>
              <option>Awaiting Applicant</option>
              <option>Unknown</option>
            </select>
          </div>
          <div class="actions-panel-section">
            <div class="actions-section-title">Requests</div>
            <a class="action-link" onclick="showToast('Signed release request sent.')">Request a Signed Release</a>
            <a class="action-link" onclick="showToast('Document upload request sent to applicant.')">Request Document Upload from Applicant</a>
          </div>
          <div class="actions-panel-section">
            <div class="actions-section-title">Attachments</div>
            <label class="action-upload-btn">
              <input type="file" accept="image/*" style="display:none;" onchange="showToast('Image attached: ' + this.files[0]?.name)">
              📷 Attach a Picture
            </label>
            <label class="action-upload-btn">
              <input type="file" accept=".pdf" style="display:none;" onchange="showToast('PDF attached: ' + this.files[0]?.name)">
              📄 Attach a PDF
            </label>
          </div>
        </div>
      </div>
    <
    </div><!-- /main-panel-content -->
    </div>

<!-- ══ RECORD EDIT MODAL ══ -->
<div class="record-edit-overlay" id="recordEditOverlay" onclick="closeEditModal(event)">
  <div class="record-edit-modal" onclick="event.stopPropagation()">
    <div class="rem-title" id="remTitle">Edit Record</div>
    <div class="rem-grid" id="remGrid">
      <!-- populated by JS -->
    </div>
    <div class="rem-move-note">* If data is in the wrong place, edit the field and save — changes are flagged for supervisor review.</div>
    <div class="rem-actions">
      <button class="rem-cancel-btn" onclick="closeEditModal()">Cancel</button>
      <button class="rem-save-btn" onclick="saveEditModal()">Save Changes</button>
    </div>
  </div>
</div>

  </main>
</div>


<!-- ══ SEARCH HISTORY MODAL ══ -->
<div class="history-overlay" id="historyOverlay" onclick="closeHistory(event)">
  <div class="history-modal">
    <div class="history-modal-header">
      <div class="history-modal-icon" id="historyIcon">🕐</div>
      <div>
        <div class="history-modal-title" id="historyTitle">Search History</div>
        <div class="history-modal-sub" id="historySub">RPT-2024-04812</div>
      </div>
      <div class="history-modal-spacer"></div>
      <button class="history-close-btn" onclick="closeHistory()">✕</button>
    </div>
    <div class="history-toolbar">
      <input class="history-search" id="historySearch" type="text" placeholder="Search history…" oninput="filterHistory()">
      <select class="history-filter" id="historyFilter" onchange="filterHistory()">
        <option value="">All Types</option>
        <option value="user">User Actions</option>
        <option value="system">System</option>
        <option value="auto">Automated</option>
        <option value="status">Status Change</option>
      </select>
      <span class="history-count" id="historyCount">— entries</span>
    </div>
    <div class="history-table-wrap">
      <table class="history-table">
        <thead>
          <tr>
            <th onclick="sortHistory('num')">Number <span class="sort-arrow">↕</span></th>
            <th onclick="sortHistory('date')" class="sorted">Date <span class="sort-arrow">↓</span></th>
            <th onclick="sortHistory('by')">By <span class="sort-arrow">↕</span></th>
            <th onclick="sortHistory('desc')">Description <span class="sort-arrow">↕</span></th>
            <th></th>
          </tr>
        </thead>
        <tbody id="historyTableBody"></tbody>
      </table>
    </div>
    <div class="history-modal-footer">
      <div class="history-footer-info" id="historyFooterInfo">Showing all entries</div>
      <button class="history-export-btn" onclick="showToast('History exported.')">↓ Export CSV</button>
    </div>
  </div>
</div>

<!-- QUEUE ENTRY LAUNCHER MODAL -->
<div id="queueLauncher" style="position:fixed;inset:0;background:rgba(17,24,39,.6);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:500;">
  <div style="background:#fff;border-radius:14px;padding:28px 32px;max-width:440px;width:92%;box-shadow:0 24px 64px rgba(0,0,0,.2);font-family:'DM Sans',sans-serif;">
    <div style="font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.08em;color:#9ca3af;margin-bottom:6px;">Simulate Entry Point</div>
    <div style="font-size:18px;font-weight:600;color:#111827;margin-bottom:4px;letter-spacing:-.3px;">How is this report being opened?</div>
    <div style="font-size:13px;color:#6b7280;margin-bottom:20px;">Choose an entry to simulate how the researcher arrives at this report.</div>
    <div style="display:flex;flex-direction:column;gap:10px;">

      <button onclick="enterFromQueue('criminal')" style="padding:12px 16px;border-radius:9px;border:1.5px solid #e5e7eb;background:#fff;text-align:left;cursor:pointer;font-family:'DM Sans',sans-serif;display:flex;align-items:center;gap:12px;transition:all .15s;" onmouseover="this.style.borderColor='#f97316';this.style.background='#fff4ed'" onmouseout="this.style.borderColor='#e5e7eb';this.style.background='#fff'">
        <span style="font-size:22px;">⚡</span>
        <div style="flex:1;">
          <div style="font-size:13px;font-weight:600;color:#111827;">From Criminal Records Queue</div>
          <div style="font-size:11px;color:#9ca3af;margin-top:1px;">Manage Backlog › Criminal Records — record 3 of 12</div>
        </div>
        <span style="font-size:10px;font-weight:700;padding:2px 7px;background:#fee2e2;color:#dc2626;border-radius:4px;flex-shrink:0;">HIT</span>
      </button>

      <button onclick="enterFromQueue('employment')" style="padding:12px 16px;border-radius:9px;border:1.5px solid #e5e7eb;background:#fff;text-align:left;cursor:pointer;font-family:'DM Sans',sans-serif;display:flex;align-items:center;gap:12px;transition:all .15s;" onmouseover="this.style.borderColor='#f97316';this.style.background='#fff4ed'" onmouseout="this.style.borderColor='#e5e7eb';this.style.background='#fff'">
        <span style="font-size:22px;">⚡</span>
        <div style="flex:1;">
          <div style="font-size:13px;font-weight:600;color:#111827;">From Employment Verification Queue</div>
          <div style="font-size:11px;color:#9ca3af;margin-top:1px;">Manage Backlog › Employment Verif. — record 7 of 28</div>
        </div>
        <span style="font-size:10px;font-weight:700;padding:2px 7px;background:#fef3c7;color:#d97706;border-radius:4px;flex-shrink:0;">PEND</span>
      </button>

      <button onclick="enterFromQueue('mvr')" style="padding:12px 16px;border-radius:9px;border:1.5px solid #e5e7eb;background:#fff;text-align:left;cursor:pointer;font-family:'DM Sans',sans-serif;display:flex;align-items:center;gap:12px;transition:all .15s;" onmouseover="this.style.borderColor='#f97316';this.style.background='#fff4ed'" onmouseout="this.style.borderColor='#e5e7eb';this.style.background='#fff'">
        <span style="font-size:22px;">⚡</span>
        <div style="flex:1;">
          <div style="font-size:13px;font-weight:600;color:#111827;">From MVR Review Queue</div>
          <div style="font-size:11px;color:#9ca3af;margin-top:1px;">Manage Backlog › MVR Review — record 2 of 9</div>
        </div>
        <span style="font-size:10px;font-weight:700;padding:2px 7px;background:#e8f0fe;color:#1a56db;border-radius:4px;flex-shrink:0;">REVIEW</span>
      </button>

      <button onclick="enterDirect()" style="padding:12px 16px;border-radius:9px;border:1.5px solid #e5e7eb;background:#fff;text-align:left;cursor:pointer;font-family:'DM Sans',sans-serif;display:flex;align-items:center;gap:12px;transition:all .15s;" onmouseover="this.style.borderColor='#6b7280';this.style.background='#f9fafb'" onmouseout="this.style.borderColor='#e5e7eb';this.style.background='#fff'">
        <span style="font-size:22px;">📋</span>
        <div>
          <div style="font-size:13px;font-weight:600;color:#111827;">Direct / Full Report View</div>
          <div style="font-size:11px;color:#9ca3af;margin-top:1px;">No queue context — show all searches</div>
        </div>
      </button>

    </div>
  </div>
</div>

<!-- ══ CONFIGURE ACTIONS DRAWER ══ -->
<div class="config-overlay" id="configOverlay" onclick="closeConfigDrawer(event)">
  <div class="config-drawer" id="configDrawer">
    <div class="config-drawer-header">
      <div>
        <div class="config-drawer-title">⚙ Configure Actions</div>
        <div class="config-drawer-sub">Show only the actions you need</div>
      </div>
      <button class="config-close-btn" onclick="closeConfigDrawer()">✕</button>
    </div>

    <!-- ORDER OPTIONS -->
    <div class="config-section" data-section="orderOptions">
      <div class="config-section-label">
        Order Options
        <span class="cs-toggle-all" onclick="toggleSection('orderOptions')">Toggle all</span>
      </div>
      <div class="config-item" onclick="toggleItem('order-additional')">
        <div class="config-item-label" id="lbl-order-additional">Order Additional Search</div>
        <button class="toggle on" id="tog-order-additional"></button>
      </div>
      <div class="config-item" onclick="toggleItem('order-statewide')">
        <div class="config-item-label" id="lbl-order-statewide">Order Statewide Search</div>
        <button class="toggle on" id="tog-order-statewide"></button>
      </div>
      <div class="config-item" onclick="toggleItem('order-court')">
        <div class="config-item-label" id="lbl-order-court">Contact Court Directly</div>
        <button class="toggle on" id="tog-order-court"></button>
      </div>
      <div class="config-item" onclick="toggleItem('order-preadverse')">
        <div class="config-item-label" id="lbl-order-preadverse">Pre-Adverse Notice</div>
        <button class="toggle on" id="tog-order-preadverse"></button>
      </div>
    </div>

    <!-- DISPOSITION -->
    <div class="config-section" data-section="disposition">
      <div class="config-section-label">
        Set Disposition
        <span class="cs-toggle-all" onclick="toggleSection('disposition')">Toggle all</span>
      </div>
      <div class="config-item" onclick="toggleItem('dispo-block')">
        <div class="config-item-label" id="lbl-dispo-block">Disposition Selector &amp; Submit</div>
        <button class="toggle on" id="tog-dispo-block"></button>
      </div>
    </div>

    <!-- CALL HISTORY -->

    <!-- OTHER ACTIONS -->

    <!-- EMPLOYMENT ACTIONS -->
    <div class="config-section" data-section="empActions">
      <div class="config-section-label">
        Employment Verification
        <span class="cs-toggle-all" onclick="toggleSection('empActions')">Toggle all</span>
      </div>
      <div class="config-item" onclick="toggleItem('emp-call')">
        <div class="config-item-label" id="lbl-emp-call">Call Employer</div>
        <button class="toggle on" id="tog-emp-call"></button>
      </div>
      <div class="config-item" onclick="toggleItem('emp-email')">
        <div class="config-item-label" id="lbl-emp-email">Email HR Department</div>
        <button class="toggle on" id="tog-emp-email"></button>
      </div>
      <div class="config-item" onclick="toggleItem('emp-fax')">
        <div class="config-item-label" id="lbl-emp-fax">Send Verification Fax</div>
        <button class="toggle on" id="tog-emp-fax"></button>
      </div>
      <div class="config-item" onclick="toggleItem('emp-billing')">
        <div class="config-item-label" id="lbl-emp-billing">Billing Adjustments</div>
        <button class="toggle on" id="tog-emp-billing"></button>
      </div>
    </div>

    <!-- MVR ACTIONS -->
    <div class="config-section" data-section="mvrActions">
      <div class="config-section-label">
        MVR Actions
        <span class="cs-toggle-all" onclick="toggleSection('mvrActions')">Toggle all</span>
      </div>
      <div class="config-item" onclick="toggleItem('mvr-order')">
        <div class="config-item-label" id="lbl-mvr-order">Order New MVR</div>
        <button class="toggle on" id="tog-mvr-order"></button>
      </div>
      <div class="config-item" onclick="toggleItem('mvr-dmv')">
        <div class="config-item-label" id="lbl-mvr-dmv">Contact DMV</div>
        <button class="toggle on" id="tog-mvr-dmv"></button>
      </div>
      <div class="config-item" onclick="toggleItem('mvr-abstract')">
        <div class="config-item-label" id="lbl-mvr-abstract">Request Driving Abstract</div>
        <button class="toggle on" id="tog-mvr-abstract"></button>
      </div>
    </div>

    <!-- EDUCATION ACTIONS -->
    <div class="config-section" data-section="eduActions">
      <div class="config-section-label">
        Education Verification
        <span class="cs-toggle-all" onclick="toggleSection('eduActions')">Toggle all</span>
      </div>
      <div class="config-item" onclick="toggleItem('edu-registrar')">
        <div class="config-item-label" id="lbl-edu-registrar">Contact Registrar</div>
        <button class="toggle on" id="tog-edu-registrar"></button>
      </div>
      <div class="config-item" onclick="toggleItem('edu-transcript')">
        <div class="config-item-label" id="lbl-edu-transcript">Request Transcript</div>
        <button class="toggle on" id="tog-edu-transcript"></button>
      </div>
      <div class="config-item" onclick="toggleItem('edu-email')">
        <div class="config-item-label" id="lbl-edu-email">Email Institution</div>
        <button class="toggle on" id="tog-edu-email"></button>
      </div>
    </div>

    <div class="config-drawer-footer">
      <button class="config-save-btn" onclick="saveConfig()">Save Preferences</button>
      <button class="config-reset-btn" onclick="resetConfig()">Reset All</button>
    </div>
  </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>





  // ── GAP ANALYSIS COLLAPSE ──


  // ── ACCOUNT NOTES ──
  let acctNotesLocked = false;
  function toggleAccountNotes(e) {
    if (acctNotesLocked) return; // don't collapse when locked
    document.getElementById('accountNotesBar').classList.toggle('collapsed');
  }
  function toggleAccountNotesLock(e) {
    e.stopPropagation();
    acctNotesLocked = !acctNotesLocked;
    const bar = document.getElementById('accountNotesBar');
    const btn = document.getElementById('acctNotesLock');
    bar.classList.toggle('locked-top', acctNotesLocked);
    bar.classList.toggle('collapsed', false); // always expand when locking
    btn.textContent = acctNotesLocked ? '🔒' : '🔓';
    btn.classList.toggle('locked', acctNotesLocked);
    btn.title = acctNotesLocked ? 'Unpin from top' : 'Pin to top';
  }

  function toggleSidebar() {
    document.body.classList.toggle('sidebar-collapsed');
    const btn = document.getElementById('sidebarToggle');
    if (btn) btn.textContent = document.body.classList.contains('sidebar-collapsed') ? '▶' : '◀';
  }

  function toggleGap(panelId) {
    const card = document.getElementById('gap-' + panelId);
    if (card) card.classList.toggle('collapsed');
  }


  // ── CHARGE / CASE TOGGLES ──
  function toggleCharge(id) {
    document.getElementById(id).classList.toggle('expanded');
  }
  function toggleCase(id) {
    const el = document.getElementById(id);
    el.classList.toggle('open');
    const arrow = el.querySelector('.case-header span:first-child');
    if (arrow) arrow.style.transform = el.classList.contains('open') ? 'rotate(90deg)' : '';
  }

  // ── RECORD EDIT MODAL ──
  const editFields = {
    'case': [
      {label:'Case Number', key:'case_num', type:'text'},
      {label:'Source', key:'source', type:'text'},
      {label:'Jurisdiction', key:'jurisdiction', type:'text'},
      {label:'Source State', key:'source_state', type:'text'},
      {label:'Offense Date', key:'offense_date', type:'text'},
      {label:'Filing Date', key:'filing_date', type:'text'},
      {label:'Disposition Date', key:'dispo_date', type:'text'},
      {label:'Pending Date', key:'pending_date', type:'text'},
      {label:'Case Comments', key:'case_comments', type:'textarea'},
    ],
    'charge': [
      {label:'Charge', key:'charge', type:'text'},
      {label:'Crime Type', key:'crime_type', type:'select', opts:['Misdemeanor','Felony','Infraction','Violation']},
      {label:'Disposition', key:'disposition', type:'select', opts:['Guilty','Not Guilty','Dismissed','Pending','Nolle Prosequi','Deferred']},
      {label:'Statute', key:'statute', type:'text'},
      {label:'Plea', key:'plea', type:'select', opts:['Guilty','Not Guilty','No Contest','Alford']},
      {label:'Arrest Date', key:'arrest_date', type:'text'},
      {label:'Offense Date', key:'offense_date', type:'text'},
      {label:'Filing Date', key:'filing_date', type:'text'},
      {label:'Sentencing Date', key:'sentencing_date', type:'text'},
      {label:'Disposition Date', key:'dispo_date', type:'text'},
      {label:'Charge Comments', key:'charge_comments', type:'textarea'},
    ]
  };
  function openEditModal(recordId, title) {
    const type = recordId.startsWith('charge') ? 'charge' : 'case';
    const fields = editFields[type];
    document.getElementById('remTitle').textContent = '✎ Edit: ' + title;
    const grid = document.getElementById('remGrid');
    grid.innerHTML = fields.map(f => {
      let input = '';
      if (f.type === 'text') input = `<input type="text" placeholder="—">`;
      else if (f.type === 'textarea') input = `<textarea placeholder="—"></textarea>`;
      else if (f.type === 'select') input = `<select>${f.opts.map(o=>`<option>${o}</option>`).join('')}</select>`;
      return `<div class="rem-field"${f.type==='textarea'?' style="grid-column:span 2"':''}><label>${f.label}</label>${input}</div>`;
    }).join('');
    document.getElementById('recordEditOverlay').classList.add('open');
  }
  function closeEditModal(e) {
    if (!e || e.target === document.getElementById('recordEditOverlay')) {
      document.getElementById('recordEditOverlay').classList.remove('open');
    }
  }
  function saveEditModal() {
    document.getElementById('recordEditOverlay').classList.remove('open');
    showToast('Record updated — flagged for supervisor review.');
  }

  // ── SEARCH GROUP EXPAND / RECORD OPEN ──
  const searchRecords = {
    'crim-1': { panel:'criminal', title:'County Criminal — Hays County, TX', breadcrumb:'County Criminal — Hays County, TX', orderNum:'F-04812', jurisdiction:'Hays County, TX', name:'(P) Wade Smith', fillStatus:'in progress', filledCode:'unknown' },
    'crim-2': { panel:'criminal', title:'County Criminal — Travis County, TX', breadcrumb:'County Criminal — Travis County, TX', orderNum:'F-04813', jurisdiction:'Travis County, TX', name:'(P) Wade Smith', fillStatus:'in progress', filledCode:'unknown' },
    'crim-3': { panel:'criminal', title:'County Criminal — Hays County, TX (Alias)', breadcrumb:'County Criminal — Hays, TX (A)', orderNum:'F-04814', jurisdiction:'Hays County, TX', name:'(A) Wade Smity', fillStatus:'complete', filledCode:'clear' },
    'crim-4': { panel:'criminal', title:'County Criminal — Travis County, TX (Alias)', breadcrumb:'County Criminal — Travis, TX (A)', orderNum:'F-04815', jurisdiction:'Travis County, TX', name:'(A) Wade Smity', fillStatus:'complete', filledCode:'clear' },
    'emp-1':  { panel:'employment', title:'Employment Verification — UT of Austin', breadcrumb:'UT of Austin (P)', orderNum:'E-04813', jurisdiction:'Austin, TX', name:'(P) Wade Smith', fillStatus:'in progress', filledCode:'unknown' },
    'emp-2':  { panel:'employment', title:'Employment Verification — UT of Austin (Alias)', breadcrumb:'UT of Austin (A)', orderNum:'E-04816', jurisdiction:'Austin, TX', name:'(A) Wade Smity', fillStatus:'complete', filledCode:'clear' },
    'mvr-1':  { panel:'mvr', title:'Motor Vehicle Record — Texas DPS', breadcrumb:'MVR — Texas DPS', orderNum:'M-04814', jurisdiction:'Texas DPS', name:'(P) Wade Smith', fillStatus:'in progress', filledCode:'unknown' },
    'edu-1':  { panel:'education', title:'Education Verification — UT of Austin', breadcrumb:'UT of Austin', orderNum:'ED-04815', jurisdiction:'Austin, TX', name:'(P) Wade Smith', fillStatus:'complete', filledCode:'clear' },
  };

  let expandedGroups = { criminal: false, employment: false, mvr: false, education: false };

  function toggleSearchGroup(type, headerEl, forceOpen, showList) {
    const sublist = document.getElementById('sublist-' + type);
    const isOpen = sublist ? sublist.classList.contains('open') : false;
    const shouldOpen = forceOpen !== undefined ? forceOpen : !isOpen;

    if (sublist) sublist.classList.toggle('open', shouldOpen);
    if (headerEl) headerEl.classList.toggle('expanded', shouldOpen);
    expandedGroups[type] = shouldOpen;

    // Show list panel if it exists, otherwise open first record directly
    if (shouldOpen && showList !== false) {
      const listPanelId = 'panel-' + type + '-list';
      const listPanel = document.getElementById(listPanelId);
      if (listPanel) {
        // Criminal has a dedicated list panel
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        listPanel.classList.add('active');
        document.querySelectorAll('.sidebar-group-header, .sidebar-item, .sidebar-subitem').forEach(el => el.classList.remove('active'));
        if (headerEl) headerEl.classList.add('active');
      } else {
        // No list panel — open the first subitem record directly
        const firstSubitem = document.querySelector('#sublist-' + type + ' .sidebar-subitem');
        if (firstSubitem) {
          const onclick = firstSubitem.getAttribute('onclick');
          if (onclick) firstSubitem.click();
        }
      }
    }
  }

  function openSearchRecord(type, recordId, subitemEl) {
    const rec = searchRecords[recordId];
    if (!rec) return;

    // Make sure group is expanded
    const sublist = document.getElementById('sublist-' + type);
    const header = document.getElementById('sidebar-' + type);
    if (sublist && !sublist.classList.contains('open')) {
      sublist.classList.add('open');
      if (header) header.classList.add('expanded');
    }

    // Activate the subitem
    document.querySelectorAll('.sidebar-subitem').forEach(el => el.classList.remove('active'));
    if (subitemEl) subitemEl.classList.add('active');

    // Deactivate group headers
    document.querySelectorAll('.sidebar-group-header, .sidebar-item').forEach(el => el.classList.remove('active'));

    // Show the panel
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    const panel = document.getElementById('panel-' + type);
    if (panel) panel.classList.add('active');

    // Update breadcrumb + title for criminal
    const bc = document.getElementById(type + '-record-breadcrumb');
    const titleEl = document.getElementById(type + '-record-title');
    if (bc) bc.textContent = rec.breadcrumb;
    if (titleEl) titleEl.textContent = rec.title;

    // Update the fill status bar meta cols
    const fsb = document.getElementById('fsbar-' + type);
    if (fsb) {
      const cols = fsb.querySelectorAll('.fsb-col-val');
      if (cols[0]) cols[0].textContent = rec.orderNum;
      if (cols[1]) cols[1].textContent = rec.jurisdiction;
    }

    // Set fill status & filled code dropdowns
    const fsSelect = document.getElementById('fillStatus-' + type);
    const fcSelect = document.getElementById('filledCode-' + type);
    if (fsSelect) {
      fsSelect.value = rec.fillStatus;
      onFillStatusChange(type, fsSelect);
    }
    if (fcSelect) {
      fcSelect.value = rec.filledCode;
      onFilledCodeChange(type, fcSelect);
    }
  }


  // ── VERIFICATION COPY ──
  function copyField(fieldId) {
    const av = document.getElementById('av-' + fieldId);
    const vi = document.getElementById('vi-' + fieldId);
    const cb = document.getElementById('cb-' + fieldId);
    if (!av || !vi) return;
    const val = av.textContent.trim();
    if (vi.tagName === 'SELECT') {
      for (let opt of vi.options) {
        if (opt.text === val) { vi.value = opt.value; break; }
      }
    } else {
      vi.value = val;
      vi.classList.add('filled');
    }
    // Flash copy button
    cb.classList.add('copied');
    setTimeout(() => cb.classList.remove('copied'), 900);
    checkMatch(fieldId);
  }

  function copyAllFields(prefix) {
    document.querySelectorAll('[id^="av-' + prefix + '"]').forEach(el => {
      const fieldId = el.id.replace('av-', '');
      copyField(fieldId);
    });
    showToast('All applicant values copied to verified fields.');
  }

  function checkMatch(fieldId) {
    const av = document.getElementById('av-' + fieldId);
    const vi = document.getElementById('vi-' + fieldId);
    const mi = document.getElementById('mi-' + fieldId);
    if (!av || !vi || !mi) return;
    const applicant = av.textContent.trim().toLowerCase();
    const verified = (vi.value || '').trim().toLowerCase();
    if (!verified) {
      mi.className = 'match-indicator match-unknown';
      mi.textContent = '?';
    } else if (verified === applicant) {
      mi.className = 'match-indicator match-yes';
      mi.textContent = '✓';
    } else {
      mi.className = 'match-indicator match-no';
      mi.textContent = '✗';
    }
  }

  // ── FILL STATUS & FILLED CODE ──
  function onFillStatusChange(panelId, sel) {
    sel.className = 'fsb-select ' + (sel.value === 'complete' ? 'status-complete' : 'status-inprogress');
  }

  function onFilledCodeChange(panelId, sel) {
    const v = sel.value.toLowerCase();
    const cls = v === 'clear' ? 'code-clear'
              : v.includes('hit') || v.includes('violation') || v.includes('suspended') || v.includes('revoked') ? 'code-hits'
              : v === 'unknown' ? 'code-unknown'
              : 'code-custom';
    sel.className = 'fsb-select ' + cls;
  }

  function saveStatus(panelId) {
    const fs = document.getElementById('fillStatus-' + panelId);
    const fc = document.getElementById('filledCode-' + panelId);
    const indicator = document.getElementById('fsbSaved-' + panelId);
    // Flash saved indicator
    indicator.classList.add('show');
    setTimeout(() => indicator.classList.remove('show'), 1800);
    showToast('Status saved — ' + (fs ? fs.options[fs.selectedIndex].text : '') + ' / ' + (fc ? fc.options[fc.selectedIndex].text : ''));
  }

  // ── SEARCH HISTORY ──
  const historyData = {
    criminal: {
      title: 'Criminal Search History',
      sub: 'County Criminal Report · Travis County, TX',
      icon: '🔍',
      entries: [
        { num:'3482/610955', date:'2024-02-15 09:32:00', by:'accio/cs4',                       type:'user',   desc:'Criminal search initiated' },
        { num:'3482/610955', date:'2024-02-15 09:32:05', by:'systemdispatcher/systemqueue',    type:'auto',   desc:'Placed in criminal review queue' },
        { num:'3482/610955', date:'2024-02-15 09:45:12', by:'accio/cs4',                       type:'user',   desc:'Reviewed record — Theft of Property' },
        { num:'3482/610955', date:'2024-02-15 09:46:03', by:'accio/cs4',                       type:'status', desc:'Updated status: In Progress' },
        { num:'3482/610955', date:'2024-02-15 10:02:17', by:'systemdispatcher/systemqueue',    type:'auto',   desc:'Work Queue Autocomplete' },
        { num:'3482/610955', date:'2024-02-15 10:02:20', by:'accio/cs4',                       type:'user',   desc:'Assigned to work queue' },
        { num:'3482/610955', date:'2024-02-15 10:02:21', by:'systemdispatcher/systemqueue',    type:'auto',   desc:'Auto_ZeroToOneDays' },
        { num:'3482/610955', date:'2024-02-15 10:02:32', by:'accio/admin',                     type:'user',   desc:'Third Party Fees Adjusted' },
        { num:'3482/610955', date:'2024-02-15 10:03:06', by:'accio/cs4',                       type:'status', desc:'Assigned to work queue AccioTest' },
        { num:'3482/610955', date:'2024-02-15 10:03:08', by:'systemdispatcher/systemqueue',    type:'auto',   desc:'Component held for review' },
        { num:'3482/610955', date:'2024-02-15 10:03:08', by:'accio/cs4',                       type:'auto',   desc:'Results placed in the review queue' },
        { num:'3482/610955', date:'2024-02-15 10:03:08', by:'accio/cs4',                       type:'status', desc:'Updated status: Pending Review' },
        { num:'3482/610955', date:'2024-02-15 10:03:20', by:'accio/cs4',                       type:'user',   desc:'No Component Completion Email Configured' },
        { num:'3482/610955', date:'2024-02-15 10:03:20', by:'accio/cs4',                       type:'status', desc:'Updated status' },
        { num:'3482/610955', date:'2024-02-14 01:56:13', by:'systemdispatcher/systemqueue',    type:'auto',   desc:'Updated status' },
        { num:'3482/610955', date:'2024-02-14 13:19:15', by:'accio/cs4',                       type:'user',   desc:'crim hidden via checkbox' },
        { num:'3482/610955', date:'2024-02-14 13:19:15', by:'accio/cs4',                       type:'user',   desc:'crim hidden via checkbox' },
        { num:'3482/610955', date:'2024-02-14 13:19:15', by:'accio/cs4',                       type:'user',   desc:'crim hidden via checkbox' },
        { num:'3482/610955', date:'2024-02-14 13:19:05', by:'accio/cs4',                       type:'user',   desc:'crim hidden via checkbox' },
        { num:'3482/610955', date:'2024-02-14 13:19:05', by:'accio/cs4',                       type:'user',   desc:'crim unhidden via checkbox' },
        { num:'3482/610955', date:'2024-02-14 11:30:00', by:'accio/cs4',                       type:'user',   desc:'Billing Cycle Time Updated' },
        { num:'3482/610955', date:'2024-02-13 08:45:22', by:'accio/cs4',                       type:'user',   desc:'Record flagged for re-verification — Drug Possession' },
        { num:'3482/610955', date:'2024-02-13 08:43:10', by:'accio/cs4',                       type:'status', desc:'Disposition set: Unknown' },
        { num:'3482/610955', date:'2024-02-13 08:40:01', by:'systemdispatcher/systemqueue',    type:'auto',   desc:'Order filed — F-04812' },
      ]
    },
    employment: {
      title: 'Employment Verification History',
      sub: 'UT of Austin · Austin, TX',
      icon: '💼',
      entries: [
        { num:'3482/610956', date:'2024-02-14 10:05:00', by:'accio/cs4',                       type:'user',   desc:'Employment verification initiated' },
        { num:'3482/610956', date:'2024-02-14 10:05:02', by:'systemdispatcher/systemqueue',    type:'auto',   desc:'Placed in employment verification queue' },
        { num:'3482/610956', date:'2024-02-14 10:05:30', by:'accio/cs4',                       type:'user',   desc:'Call attempted — No Answer' },
        { num:'3482/610956', date:'2024-02-14 10:06:00', by:'accio/cs4',                       type:'status', desc:'Status set: In Progress' },
        { num:'3482/610956', date:'2024-02-14 11:00:15', by:'systemdispatcher/systemqueue',    type:'auto',   desc:'Auto follow-up email sent to HR' },
        { num:'3482/610956', date:'2024-02-14 14:22:08', by:'accio/cs4',                       type:'user',   desc:'Fax sent to employer' },
        { num:'3482/610956', date:'2024-02-14 14:23:00', by:'accio/cs4',                       type:'status', desc:'Updated status: Pending Response' },
        { num:'3482/610956', date:'2024-02-15 09:10:44', by:'accio/cs4',                       type:'user',   desc:'Employer response received' },
        { num:'3482/610956', date:'2024-02-15 09:11:00', by:'accio/cs4',                       type:'status', desc:'Status updated: Verifying Details' },
      ]
    },
    mvr: {
      title: 'MVR History',
      sub: 'Texas DPS · State of Texas',
      icon: '🚗',
      entries: [
        { num:'3482/610957', date:'2024-02-14 08:00:01', by:'systemdispatcher/systemqueue',    type:'auto',   desc:'MVR order submitted to Texas DPS' },
        { num:'3482/610957', date:'2024-02-14 08:04:33', by:'systemdispatcher/systemqueue',    type:'auto',   desc:'MVR response received — 2 violations' },
        { num:'3482/610957', date:'2024-02-14 08:04:34', by:'systemdispatcher/systemqueue',    type:'auto',   desc:'Placed in MVR review queue' },
        { num:'3482/610957', date:'2024-02-14 08:05:00', by:'systemdispatcher/systemqueue',    type:'status', desc:'Status set: Review Required' },
        { num:'3482/610957', date:'2024-02-14 09:55:20', by:'accio/cs4',                       type:'user',   desc:'Speeding violation reviewed — Accept' },
        { num:'3482/610957', date:'2024-02-14 09:56:01', by:'accio/cs4',                       type:'user',   desc:'Red light violation — flagged for review' },
        { num:'3482/610957', date:'2024-02-14 09:57:00', by:'accio/cs4',                       type:'status', desc:'Disposition set: Review Required — Violations Found' },
      ]
    },
    education: {
      title: 'Education Verification History',
      sub: 'University of Texas at Austin · Austin, TX',
      icon: '🎓',
      entries: [
        { num:'3482/610958', date:'2024-02-14 08:30:00', by:'accio/cs4',                       type:'user',   desc:'Education verification initiated' },
        { num:'3482/610958', date:'2024-02-14 08:30:03', by:'systemdispatcher/systemqueue',    type:'auto',   desc:'Placed in education verification queue' },
        { num:'3482/610958', date:'2024-02-14 09:00:10', by:'accio/cs4',                       type:'user',   desc:'Contacted UT Austin Registrar' },
        { num:'3482/610958', date:'2024-02-14 09:01:00', by:'accio/cs4',                       type:'status', desc:'Status set: In Progress' },
        { num:'3482/610958', date:'2024-02-14 11:30:22', by:'accio/admin',                     type:'user',   desc:'Transcript received and verified' },
        { num:'3482/610958', date:'2024-02-14 11:31:00', by:'accio/admin',                     type:'user',   desc:'Degree confirmed: BS Computer Science — Graduated 05/2004' },
        { num:'3482/610958', date:'2024-02-14 11:32:05', by:'accio/admin',                     type:'status', desc:'Disposition set: Verified — Clear' },
        { num:'3482/610958', date:'2024-02-14 11:32:10', by:'systemdispatcher/systemqueue',    type:'auto',   desc:'Education verification complete — marked Clear' },
      ]
    }
  };

  let currentHistorySearch = '';
  let currentHistoryFilter = '';
  let currentHistoryType = null;
  let historySortCol = 'date';
  let historySortDir = -1;
  let allHistoryEntries = [];

  function openHistory(type) {
    currentHistoryType = type;
    const data = historyData[type];
    document.getElementById('historyTitle').textContent = data.title;
    document.getElementById('historySub').textContent = data.sub;
    document.getElementById('historyIcon').textContent = data.icon;
    document.getElementById('historySearch').value = '';
    document.getElementById('historyFilter').value = '';
    currentHistorySearch = '';
    currentHistoryFilter = '';
    allHistoryEntries = [...data.entries];
    historySortCol = 'date';
    historySortDir = -1;
    renderHistoryTable();
    document.getElementById('historyOverlay').classList.add('open');
    document.body.style.overflow = 'hidden';
  }

  function closeHistory(e) {
    if (e && e.target !== document.getElementById('historyOverlay')) return;
    document.getElementById('historyOverlay').classList.remove('open');
    document.body.style.overflow = '';
  }

  function filterHistory() {
    currentHistorySearch = document.getElementById('historySearch').value.toLowerCase();
    currentHistoryFilter = document.getElementById('historyFilter').value;
    renderHistoryTable();
  }

  function sortHistory(col) {
    if (historySortCol === col) historySortDir *= -1;
    else { historySortCol = col; historySortDir = -1; }
    document.querySelectorAll('.history-table th').forEach(th => th.classList.remove('sorted'));
    renderHistoryTable();
  }

  function renderHistoryTable() {
    let entries = [...allHistoryEntries];

    // Filter
    if (currentHistoryFilter) entries = entries.filter(e => e.type === currentHistoryFilter);
    if (currentHistorySearch) entries = entries.filter(e =>
      e.desc.toLowerCase().includes(currentHistorySearch) ||
      e.by.toLowerCase().includes(currentHistorySearch) ||
      e.num.includes(currentHistorySearch)
    );

    // Sort
    entries.sort((a, b) => {
      let av = a[historySortCol === 'num' ? 'num' : historySortCol === 'by' ? 'by' : historySortCol === 'desc' ? 'desc' : 'date'];
      let bv = b[historySortCol === 'num' ? 'num' : historySortCol === 'by' ? 'by' : historySortCol === 'desc' ? 'desc' : 'date'];
      return av < bv ? historySortDir : av > bv ? -historySortDir : 0;
    });

    const typeLabels = { user:'User', system:'System', auto:'Auto', status:'Status' };
    const typeBadges = { user:'hbadge-user', system:'hbadge-system', auto:'hbadge-auto', status:'hbadge-status' };

    const tbody = document.getElementById('historyTableBody');
    tbody.innerHTML = entries.map(e => `
      <tr>
        <td class="td-num">${e.num}</td>
        <td class="td-date">${e.date}</td>
        <td class="td-by">${e.by}</td>
        <td class="td-desc">
          <span class="history-type-badge ${typeBadges[e.type]}">${typeLabels[e.type]}</span>${e.desc}
        </td>
        <td class="td-detail"><a onclick="showToast('Opening detail...')">Show details</a></td>
      </tr>
    `).join('');

    const total = historyData[currentHistoryType].entries.length;
    document.getElementById('historyCount').textContent = `${entries.length} of ${total} entries`;
    document.getElementById('historyFooterInfo').textContent =
      entries.length < total ? `Filtered — showing ${entries.length} of ${total} entries` : `Showing all ${total} entries`;
  }

  // ── ACTION CONFIGURATOR ──
  const defaultConfig = {
    'order-additional': true, 'order-statewide': true, 'order-court': true, 'order-preadverse': true,
    'dispo-block': true,
    'call-log': true, 'call-add': true,
    'act-supervisor': true, 'act-email': true, 'act-flag': true,
    'emp-call': true, 'emp-email': true, 'emp-fax': true, 'emp-billing': true,
    'mvr-order': true, 'mvr-dmv': true, 'mvr-abstract': true,
    'edu-registrar': true, 'edu-transcript': true, 'edu-email': true,
  };
  let actionConfig = JSON.parse(JSON.stringify(defaultConfig));
  let tempConfig = {};

  function openConfigDrawer() {
    tempConfig = JSON.parse(JSON.stringify(actionConfig));
    renderConfigToggles();
    document.getElementById('configOverlay').classList.add('open');
    document.body.style.overflow = 'hidden';
  }

  function closeConfigDrawer(e) {
    if (e && e.target !== document.getElementById('configOverlay')) return;
    document.getElementById('configOverlay').classList.remove('open');
    document.body.style.overflow = '';
  }

  function renderConfigToggles() {
    Object.entries(tempConfig).forEach(([id, on]) => {
      const tog = document.getElementById('tog-' + id);
      const lbl = document.getElementById('lbl-' + id);
      if (tog) tog.classList.toggle('on', on);
      if (lbl) lbl.classList.toggle('disabled-label', !on);
    });
  }

  function toggleItem(id) {
    tempConfig[id] = !tempConfig[id];
    const tog = document.getElementById('tog-' + id);
    const lbl = document.getElementById('lbl-' + id);
    if (tog) tog.classList.toggle('on', tempConfig[id]);
    if (lbl) lbl.classList.toggle('disabled-label', !tempConfig[id]);
  }

  function toggleSection(sectionName) {
    // Find all toggles in this section
    const section = document.querySelector('[data-section="' + sectionName + '"]');
    if (!section) return;
    const items = section.querySelectorAll('.config-item');
    // Determine if all are on
    const allOn = Array.from(items).every(item => {
      const id = item.querySelector('.toggle').id.replace('tog-','');
      return tempConfig[id] !== false;
    });
    items.forEach(item => {
      const id = item.querySelector('.toggle').id.replace('tog-','');
      tempConfig[id] = !allOn;
    });
    renderConfigToggles();
  }

  function saveConfig() {
    actionConfig = JSON.parse(JSON.stringify(tempConfig));
    applyConfig();
    document.getElementById('configOverlay').classList.remove('open');
    document.body.style.overflow = '';
    showToast('Action preferences saved.');
  }

  function resetConfig() {
    tempConfig = JSON.parse(JSON.stringify(defaultConfig));
    renderConfigToggles();
  }

  function applyConfig() {
    // Show/hide individual action links
    document.querySelectorAll('[data-aid]').forEach(el => {
      const aid = el.getAttribute('data-aid');
      if (actionConfig[aid] === false) {
        el.classList.add('action-hidden');
      } else {
        el.classList.remove('action-hidden');
      }
    });

    // Disposition block — special case (it's a full section, not just a link)
    document.querySelectorAll('.actions-panel .actions-panel-section').forEach(section => {
      const title = section.querySelector('.actions-section-title');
      if (title && title.textContent.trim() === 'Set Disposition') {
        section.style.display = actionConfig['dispo-block'] ? '' : 'none';
      }
      if (title && title.textContent.trim() === 'Billing Adjustments') {
        section.style.display = actionConfig['emp-billing'] ? '' : 'none';
      }
      // Hide sections where all links are hidden
      const links = section.querySelectorAll('.action-link');
      if (links.length > 0) {
        const allHidden = Array.from(links).every(l => l.classList.contains('action-hidden'));
        if (allHidden && (!title || (title.textContent.trim() !== 'Set Disposition' && title.textContent.trim() !== 'Billing Adjustments'))) {
          section.style.display = 'none';
        } else if (!allHidden) {
          if (!title || (title.textContent.trim() !== 'Set Disposition' && title.textContent.trim() !== 'Billing Adjustments')) {
            section.style.display = '';
          }
        }
      }
    });

    // Handle call history visibility (call-log = the call history items block)
    document.querySelectorAll('.call-history-item').forEach(el => {
      el.style.display = actionConfig['call-log'] ? '' : 'none';
    });
  }

  // ── QUEUE CONFIG ──
  const Q = {
    criminal:   { label:'Criminal Records Queue',        detail:'Manage Backlog › Criminal Records › RPT-2024-04812',    pos:3,  total:12, modeText:'Queue Focus: Criminal',   defaultRecord:'crim-1', defaultSubitem:'subitem-crim-1' },
    employment: { label:'Employment Verification Queue', detail:'Manage Backlog › Employment Verif. › RPT-2024-04812',   pos:7,  total:28, modeText:'Queue Focus: Employment', defaultRecord:'emp-1',  defaultSubitem:'subitem-emp-1' },
    mvr:        { label:'MVR Review Queue',              detail:'Manage Backlog › MVR Review › RPT-2024-04812',           pos:2,  total:9,  modeText:'Queue Focus: MVR',        defaultRecord:'mvr-1',  defaultSubitem:'subitem-mvr-1' },
  };
  const SEARCH_IDS = ['criminal','employment','mvr','education'];
  let currentQueue = null;
  let qPos = 0, qTotal = 0;

  // ── ENTRY POINTS ──
  function enterFromQueue(type) {
    currentQueue = type;
    const cfg = Q[type];
    qPos = cfg.pos; qTotal = cfg.total;
    hideLauncher();
    document.body.classList.add('queue-mode');

    // Banner
    const banner = document.getElementById('queueBanner');
    document.getElementById('qbText').textContent = cfg.label;
    document.getElementById('qbDetail').textContent = cfg.detail;
    document.getElementById('qbPos').textContent = qPos + ' of ' + qTotal + ' in queue';
    document.getElementById('queueModeText').textContent = cfg.modeText;
    banner.classList.remove('hidden');
    updateQueueArrows();

    // Sidebar focus
    SEARCH_IDS.forEach(k => {
      const el = document.getElementById('sidebar-' + k);
      if (!el) return;
      el.classList.remove('queue-focused','queue-hidden','active');
      if (k === type) el.classList.add('queue-focused');
      else el.classList.add('queue-hidden');
    });

    // Expand the sidebar group (so subitems are visible) but go directly to the specific record
    const header = document.getElementById('sidebar-' + type);
    const sublist = document.getElementById('sublist-' + type);
    if (sublist) sublist.classList.add('open');
    if (header) header.classList.add('expanded');

    // Open the specific record the researcher is coming from (first/default record for this queue type)
    const subitemEl = document.getElementById(cfg.defaultSubitem);
    openSearchRecord(type, cfg.defaultRecord, subitemEl);
  }

  function enterDirect() {
    currentQueue = null;
    hideLauncher();
    document.body.classList.remove('queue-mode');
    document.getElementById('queueBanner').classList.add('hidden');
    SEARCH_IDS.forEach(k => {
      const el = document.getElementById('sidebar-' + k);
      if (el) el.classList.remove('queue-focused','queue-hidden');
    });
    openPanel('overview', document.getElementById('sidebar-overview'));
  }

  function hideLauncher() {
    const l = document.getElementById('queueLauncher');
    l.style.opacity = '0'; l.style.transition = 'opacity .2s';
    setTimeout(() => l.style.display='none', 200);
  }

  function goBackToQueue() {
    showToast('Returning to queue…');
    setTimeout(() => {
      document.getElementById('queueLauncher').style.cssText = 'position:fixed;inset:0;background:rgba(17,24,39,.6);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:500;opacity:1;';
      enterDirect();
    }, 700);
  }

  function queueNav(dir) {
    qPos = Math.max(1, Math.min(qTotal, qPos + dir));
    document.getElementById('qbPos').textContent = qPos + ' of ' + qTotal + ' in queue';
    updateQueueArrows();
    showToast(dir > 0 ? 'Loading next record in queue…' : 'Loading previous record…');
  }

  function updateQueueArrows() {
    document.getElementById('qbPrev').classList.toggle('disabled', qPos <= 1);
    document.getElementById('qbNext').classList.toggle('disabled', qPos >= qTotal);
  }

  // ── PANEL SWITCHING ──
  function openPanel(name, sidebarEl) {
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    const t = document.getElementById('panel-' + name);
    if (t) t.classList.add('active');
    document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
    if (sidebarEl) sidebarEl.classList.add('active');
    // If in queue mode and the opened panel is NOT the focused search, show a subtle notice
    if (currentQueue && sidebarEl && sidebarEl.classList.contains('queue-hidden')) {
      showToast('Viewing outside queue focus — ' + name.charAt(0).toUpperCase() + name.slice(1));
    }
  }

  function showPanel(name, clickedEl) {
    openPanel(name, clickedEl);
  }

  // Tab switching
  function switchTab(tab, contentId) {
    tab.parentElement.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    ['tab-records','tab-subject-detail','tab-case-notes'].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = (id === contentId) ? 'block' : 'none';
    });
  }

  // Toggle record expand + checkbox
  function toggleRecord(row) {
    const id = row.id.split('-')[2];
    const expandRow = document.getElementById('rec-expand-' + id);
    const chk = document.getElementById('chk-' + id);
    if (!expandRow) return;
    const isOpen = expandRow.classList.contains('open');
    document.querySelectorAll('.expand-row').forEach(r => r.classList.remove('open'));
    document.querySelectorAll('.records-table tr').forEach(r => r.classList.remove('selected'));
    document.querySelectorAll('.custom-checkbox').forEach(c => c.classList.remove('checked'));
    if (!isOpen) {
      expandRow.classList.add('open');
      row.classList.add('selected');
      if (chk) chk.classList.add('checked');
    }
  }

  // Subject bar collapse
  let sbExpanded = true;
  function toggleSubjectBar() {
    sbExpanded = !sbExpanded;
    const bar = document.getElementById('subjectBar');
    const btn = document.getElementById('sbCollapseBtn');
    bar.classList.toggle('collapsed', !sbExpanded);
    btn.title = sbExpanded ? 'Collapse subject info' : 'Expand subject info';
    btn.textContent = sbExpanded ? '▲' : '▼';
  }

  // Toast
  let toastTimeout;
  function showToast(msg) {
    const toast = document.getElementById('toast');
    if (!toast) return;
    toast.textContent = msg;
    toast.classList.add('show');
    clearTimeout(toastTimeout);
    toastTimeout = setTimeout(() => toast.classList.remove('show'), 2800);
  }

</script>
</body>
</html>